# 智能问答系统显示规则与匹配逻辑完整说明

## 一、销售业绩卡片显示规则

### 1.1 数据为空/无数据时的显示逻辑

#### 场景定义
当系统查询不到任何销售数据，或数据源返回空结果时，卡片应遵循以下显示规则。

#### 显示方案

**方案A：完整空状态卡片（推荐）**

```
┌─────────────────────────────────────────────────────┐
│  2024年度销售额                                      │
│                                                      │
│              ┌─────────┐                            │
│              │    📊    │  (灰色图标，降低透明度)    │
│              └─────────┘                            │
│                                                      │
│              暂无数据                                │
│                                                      │
│  提示：当前查询条件下暂无销售数据                    │
│                                                      │
│  建议：                                              │
│  • 调整查询时间范围                                  │
│  • 检查数据源连接                                    │
│  • 联系管理员确认数据权限                            │
│                                                      │
│  ┌──────────────────┐  ┌──────────────────┐        │
│  │  修改查询条件    │  │    刷新数据      │        │
│  └──────────────────┘  └──────────────────┘        │
└─────────────────────────────────────────────────────┘
```

**方案B：简化空状态（数据量极小场景）**

```
┌─────────────────────────────────────────────────────┐
│  2024年度销售额                                      │
│                                                      │
│              ┌─────────┐                            │
│              │    📊    │                            │
│              └─────────┘                            │
│                                                      │
│              暂无数据                                │
│                                                      │
│  当前查询条件下暂无销售数据                          │
└─────────────────────────────────────────────────────┘
```

#### 判断逻辑

**判断流程原型图：**

```
┌─────────────────────────────────────────────────────┐
│  输入：查询结果 + 查询上下文                          │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤1：检查数据是否存在                             │
│  ┌──────────────────────────────────────────────┐  │
│  │  if (salesData === null || salesData.length === 0) │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  数据为空 → 进入步骤2                                │
│  有数据 → 进入步骤4                                  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤2：判断空数据原因                                │
│  ┌──────────────────────────────────────────────┐  │
│  │  检查查询条件：                                │  │
│  │  • 时间范围是否有效？                          │  │
│  │  • 筛选条件是否合理？                          │  │
│  │  • 数据源连接是否正常？                        │  │
│  │  • 用户权限是否充足？                          │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │查询条件错误│  │连接失败  │  │权限不足  │         │
│  └──────────┘  └──────────┘  └──────────┘         │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤3：选择对应的空状态方案                          │
│  ┌──────────────────────────────────────────────┐  │
│  │  场景1：查询条件错误                          │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ 完整空状态卡片 + 错误提示               │  │  │
│  │  │ • 突出显示错误条件                     │  │  │
│  │  │ • 提供修正建议                         │  │  │
│  │  │ • 快速操作按钮                         │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │                                              │  │
│  │  场景2：数据源连接失败                        │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ 错误状态卡片                           │  │  │
│  │  │ • "数据源连接失败"提示                  │  │  │
│  │  │ • 重试按钮                             │  │  │
│  │  │ • 检查连接按钮                         │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │                                              │  │
│  │  场景3：权限不足                             │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ 权限提示卡片                           │  │  │
│  │  │ • "暂无数据访问权限"提示                │  │  │
│  │  │ • 联系管理员按钮                       │  │  │
│  │  │ • 申请权限按钮                         │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │                                              │  │
│  │  场景4：确实无数据                           │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ 完整空状态卡片                         │  │  │
│  │  │ • "暂无数据"提示                       │  │  │
│  │  │ • 操作建议列表                         │  │  │
│  │  │ • 修改查询/刷新按钮                    │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤4：检查数据格式                                 │
│  ┌──────────────────────────────────────────────┐  │
│  │  if (isValidDataFormat(salesData))            │  │
│  │    → 正常显示                                 │  │
│  │  else                                         │  │
│  │    → 显示数据格式错误提示                      │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  输出：对应的空状态卡片或正常数据卡片                  │
└─────────────────────────────────────────────────────┘
```

**场景1：完全无数据**
- 如果查询条件可能有问题（如时间范围错误）→ 显示完整空状态卡片，包含错误提示和修正建议
- 如果数据源确实无数据 → 显示完整空状态卡片，包含操作建议和快速操作按钮

**场景2：数据格式错误**
- 显示错误状态卡片
- 提示"数据格式错误"
- 提供重试、检查连接等操作

**场景3：权限不足**
- 显示权限提示卡片
- 提示"暂无数据访问权限"
- 提供联系管理员、申请权限等操作

#### 不同空数据场景的处理策略

**场景对比原型图：**

```
┌─────────────────────────────────────────────────────┐
│  场景1：完全无数据                                   │
│  ┌──────────────────────────────────────────────┐  │
│  │  2024年度销售额                                │  │
│  │              ┌─────────┐                     │  │
│  │              │    📊    │  (灰色，50%透明度)   │  │
│  │              └─────────┘                     │  │
│  │              暂无数据                        │  │
│  │  提示：当前查询条件下暂无销售数据              │  │
│  │  建议：• 调整查询时间范围                     │  │
│  │        • 检查数据源连接                       │  │
│  │        • 联系管理员确认数据权限                │  │
│  │  [修改查询条件]  [刷新数据]                   │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  场景2：查询条件错误                                 │
│  ┌──────────────────────────────────────────────┐  │
│  │  2024年度销售额                                │  │
│  │              ┌─────────┐                     │  │
│  │              │    ⚠️    │  (橙色警告图标)     │  │
│  │              └─────────┘                     │  │
│  │              查询条件可能有误                 │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ ⚠️  错误条件：时间范围 2030-01-01      │  │  │
│  │  │     建议：请选择有效的时间范围          │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │  [修正查询条件]  [使用默认时间范围]          │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  场景3：数据源连接失败                                │
│  ┌──────────────────────────────────────────────┐  │
│  │  2024年度销售额                                │  │
│  │              ┌─────────┐                     │  │
│  │              │    🔌    │  (红色错误图标)     │  │
│  │              └─────────┘                     │  │
│  │              数据源连接失败                    │  │
│  │  提示：无法连接到数据源，请检查网络连接        │  │
│  │  [重试连接]  [检查连接]  [联系技术支持]        │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  场景4：权限不足                                     │
│  ┌──────────────────────────────────────────────┐  │
│  │  2024年度销售额                                │  │
│  │              ┌─────────┐                     │  │
│  │              │    🔒    │  (灰色锁定图标)     │  │
│  │              └─────────┘                     │  │
│  │              暂无数据访问权限                  │  │
│  │  提示：您没有访问此数据的权限                  │  │
│  │  [联系管理员]  [申请权限]  [查看权限说明]      │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

| 场景 | 显示方案 | 用户提示 | 操作建议 |
|------|---------|---------|---------|
| 完全无数据 | 完整空状态卡片 | "暂无数据" | 提供修改查询、刷新等操作 |
| 查询条件错误 | 完整空状态卡片 + 错误提示 | "查询条件可能有误" | 突出显示错误条件，提供修正建议 |
| 数据源连接失败 | 错误状态卡片 | "数据源连接失败" | 提供重试、检查连接等操作 |
| 权限不足 | 权限提示卡片 | "暂无数据访问权限" | 提供联系管理员、申请权限等操作 |

#### 实现要点
- **卡片框架保留**：保持卡片容器和标题结构，确保UI一致性
- **内容区域替换**：用空状态组件替换数据展示区域
- **交互引导**：提供明确的引导文案和操作建议
- **视觉层次**：使用灰色系、降低透明度，与有数据状态形成对比
- **可操作性**：提供快速操作按钮，帮助用户快速调整查询条件

---

### 1.2 数据量极小（如仅一天）时的显示逻辑

#### 场景定义
当查询时间范围极短（如仅1天、2天），或数据点少于3个时，季度分解展示失去意义。需要根据数据量动态调整显示内容。

#### 显示方案

**场景A：单日数据（1天）**

```
┌─────────────────────────────────────────────────────┐
│  2024年度销售额                                      │
│                                                      │
│  ¥823万元                                            │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ ℹ️  数据时间范围：2024-12-01                  │ │
│  │     单日数据，暂不展示季度分解和同比            │ │
│  └────────────────────────────────────────────────┘ │
│  (浅蓝色背景)                                        │
│                                                      │
│  数据来源：销售流水                                  │
└─────────────────────────────────────────────────────┘
```

**场景B：短期数据（2-6天）**

```
┌─────────────────────────────────────────────────────┐
│  2024年度销售额                                      │
│                                                      │
│  ¥3856万元    ↑ 19.8% 同比增长                     │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ ℹ️  数据时间范围较短（6天），                   │ │
│  │     暂不展示季度分解                             │ │
│  └────────────────────────────────────────────────┘ │
│  (浅蓝色背景)                                        │
│                                                      │
│  数据来源：2024-12-01 至 2024-12-06                 │
└─────────────────────────────────────────────────────┘
```

**场景C：数据点不足（少于3个）**

```
┌─────────────────────────────────────────────────────┐
│  2024年度销售额                                      │
│                                                      │
│  ¥3856万元                                            │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ ⚠️  数据点不足（仅2个），                       │ │
│  │     无法进行季度分析和趋势对比                   │ │
│  │                                                  │ │
│  │ 建议：扩大查询时间范围以获得更完整分析            │ │
│  └────────────────────────────────────────────────┘ │
│  (浅黄色背景)                                        │
└─────────────────────────────────────────────────────┘
```

#### 判断阈值与规则

| 数据特征 | 阈值 | 显示策略 | 隐藏内容 |
|---------|------|---------|---------|
| 时间范围 | < 7天 | 隐藏季度分解 | 季度数据、季度对比 |
| 数据点数量 | < 3个 | 隐藏所有分解和对比 | 季度分解、同比/环比、趋势图 |
| 单日数据 | = 1天 | 仅显示汇总值 | 季度分解、同比/环比、趋势分析 |
| 跨季度但数据不足 | 时间跨度>7天但数据点<3 | 显示汇总，隐藏分解 | 季度分解、详细对比 |

#### 判断逻辑流程

**数据量判断流程图：**

```
┌─────────────────────────────────────────────────────┐
│  输入：salesData[] + startDate + endDate            │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤1：计算时间范围                                 │
│  ┌──────────────────────────────────────────────┐  │
│  │  daysDiff = (endDate - startDate) / 86400000  │  │
│  │  dataPoints = salesData.length                │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌────────────┐                                     │
│  │ daysDiff=1?│ → 是 → 单日数据场景                │
│  └────────────┘                                     │
│    否 ↓                                             │
│  ┌────────────┐                                     │
│  │daysDiff<7? │ → 是 → 短期数据场景                │
│  └────────────┘                                     │
│    否 ↓                                             │
│  继续检查                                            │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤2：检查数据点数量                               │
│  ┌──────────────────────────────────────────────┐  │
│  │  if (dataPoints < 3)                         │  │
│  │    → 数据点不足场景                           │  │
│  │  else if (dataPoints >= 3 && daysDiff < 7)   │  │
│  │    → 短期数据场景（但可显示同比）             │  │
│  │  else                                        │  │
│  │    → 继续检查季度完整性                        │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤3：检查季度完整性                               │
│  ┌──────────────────────────────────────────────┐  │
│  │  if (daysDiff > 7 && dataPoints < 3)        │  │
│  │    → 跨季度但数据不足场景                     │  │
│  │                                              │  │
│  │  检查每个季度的数据点：                       │  │
│  │  • Q1数据点 >= 2?                           │  │
│  │  • Q2数据点 >= 2?                           │  │
│  │  • Q3数据点 >= 2?                           │  │
│  │  • Q4数据点 >= 2?                           │  │
│  │                                              │  │
│  │  if (所有季度都有足够数据点)                 │  │
│  │    → 显示完整季度分解                         │  │
│  │  else                                        │  │
│  │    → 隐藏季度分解，显示汇总值                  │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤4：生成显示配置                                 │
│  ┌──────────────────────────────────────────────┐  │
│  │  DisplayConfig {                             │  │
│  │    showQuarterlyBreakdown: boolean,           │  │
│  │    showYearOverYear: boolean,                │  │
│  │    showTrendChart: boolean,                  │  │
│  │    infoMessage?: string,                      │  │
│  │    warningMessage?: string                    │  │
│  │  }                                            │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  输出：DisplayConfig + 对应的提示信息                 │
└─────────────────────────────────────────────────────┘
```

**详细判断步骤：**

1. **检查时间范围**
   - 计算开始日期和结束日期的天数差
   - 如果天数差 = 1 → 单日数据场景
   - 如果天数差 < 7 → 短期数据场景

2. **检查数据点数量**
   - 统计实际数据点数量
   - 如果数据点 < 3 → 数据点不足场景

3. **检查季度完整性**
   - 如果时间跨度 > 7天，但数据点 < 3 → 跨季度但数据不足场景
   - 检查是否有完整的季度数据（每个季度至少2个数据点）

4. **生成显示配置**
   - 根据场景决定显示/隐藏的内容
   - 生成相应的信息提示或警告提示

#### 用户体验考虑
- **信息密度平衡**：避免在数据不足时强行展示无意义的分解
- **透明度**：明确告知用户为何不显示某些数据，提供具体原因
- **渐进式展示**：随着数据量增加，逐步展示更详细的分析
- **引导性**：在数据不足时，提供明确的改进建议（如扩大时间范围）
- **视觉区分**：使用不同颜色的提示条（信息/警告）区分不同场景

---

### 1.3 用户选择隐藏推荐区域时的显示逻辑

#### 场景定义
用户通过设置或交互操作，选择隐藏"推荐问题"或"快速操作"区域。系统需要支持：
1. 局部隐藏（单个卡片内的推荐区域）
2. 全局隐藏（所有卡片的推荐区域）
3. 临时隐藏（仅当前会话）
4. 永久隐藏（跨会话保持）

#### 布局变化方案

**隐藏前（完整布局）：**

```
┌─────────────────────────────────────────────────────┐
│  销售业绩卡片（主内容区）                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 2024年度销售额                                │  │
│  │ ¥3856万元  ↑ 19.8% 同比增长                 │  │
│  │                                              │  │
│  │ Q1: 823万  Q2: 945万  Q3: 1028万  Q4: 1060万│  │
│  │                                              │  │
│  │ [年度趋势对比图表]                            │  │
│  │  ┌────────────────────────────────────┐     │  │
│  │  │  2024 vs 2023 趋势对比图          │     │  │
│  │  └────────────────────────────────────┘     │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 💡 推荐问题                    [隐藏] [不再显示]│ │
│  │ ┌──────────────────────────────────────────┐  │ │
│  │ │ • 查看地区分布                            │  │ │
│  │ │ • 分析渠道构成                            │  │ │
│  │ │ • 对比去年同期                            │  │ │
│  │ │ • 分析增长来源                            │  │ │
│  │ └──────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

**隐藏后（紧凑布局）：**

```
┌─────────────────────────────────────────────────────┐
│  销售业绩卡片（主内容区）                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 2024年度销售额                                │  │
│  │ ¥3856万元  ↑ 19.8% 同比增长                 │  │
│  │                                              │  │
│  │ Q1: 823万  Q2: 945万  Q3: 1028万  Q4: 1060万│  │
│  │                                              │  │
│  │ [年度趋势对比图表]                            │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │        [显示推荐问题 ▼]  ← 可重新展开         │ │
│  └────────────────────────────────────────────────┘ │
│  (紧凑布局，间距减小)                                │
└─────────────────────────────────────────────────────┘
```

**完全隐藏后（无折叠触发器）：**

```
┌─────────────────────────────────────────────────────┐
│  销售业绩卡片（主内容区）                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 2024年度销售额                                │  │
│  │ ¥3856万元  ↑ 19.8% 同比增长                 │  │
│  │                                              │  │
│  │ Q1: 823万  Q2: 945万  Q3: 1028万  Q4: 1060万│  │
│  │                                              │  │
│  │ [年度趋势对比图表]                            │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  （推荐区域已隐藏，可在设置中恢复）                   │
└─────────────────────────────────────────────────────┘
```

#### 状态管理规则

**状态层级架构图：**

```
┌─────────────────────────────────────────────────────┐
│  状态层级结构                                         │
│  ┌──────────────────────────────────────────────┐  │
│  │  层级1：局部状态 (localVisible)               │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ 作用范围：当前卡片的推荐区域             │  │  │
│  │  │ 生命周期：当前组件实例                   │  │  │
│  │  │ 存储位置：组件内部 state                 │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │            ↓ 继承自                          │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  层级2：全局状态 (globalVisible)         │  │  │
│  │  │  作用范围：所有卡片的推荐区域             │  │  │
│  │  │  生命周期：当前会话                       │  │  │
│  │  │  存储位置：应用级 state                   │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │            ↓ 继承自                          │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  层级3：持久化状态 (persisted)          │  │  │
│  │  │  作用范围：跨会话的所有卡片              │  │  │
│  │  │  生命周期：永久（直到用户修改）          │  │  │
│  │  │  存储位置：localStorage                 │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**状态流转图：**

```
┌─────────────────────────────────────────────────────┐
│  初始状态                                             │
│  ┌──────────────────────────────────────────────┐  │
│  │  读取 localStorage                            │  │
│  │  • showRecommendations: true/false           │  │
│  │  • showRecommendationsPersisted: true/false   │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  初始化状态                                    │  │
│  │  localVisible = globalVisible =              │  │
│  │    getUserPreference('showRecommendations')   │  │
│  │  persisted =                                  │  │
│  │    getUserPreference('showRecommendationsPersisted')│
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
        ┌───────────────────────┐
        │  用户操作              │
        └───────────────────────┘
                ↓
    ┌───────────┴───────────┐
    │                       │
┌───▼────┐            ┌─────▼────┐
│点击隐藏│            │点击不再显示│
└───┬────┘            └─────┬────┘
    │                       │
    │临时隐藏               │永久隐藏
    │                       │
    ↓                       ↓
┌─────────────────┐  ┌─────────────────┐
│ 更新局部状态     │  │ 更新所有状态     │
│ localVisible=false│ │ localVisible=false│
│ (不保存)         │  │ globalVisible=false│
│                  │  │ persisted=true   │
│                  │  │ 保存到localStorage│
└─────────────────┘  └─────────────────┘
    │                       │
    └───────────┬───────────┘
                ↓
┌──────────────────────────────────────────────┐
│  状态生效                                       │
│  • 推荐区域隐藏/折叠                            │
│  • 显示展开按钮（临时隐藏）或完全隐藏（永久）    │
└──────────────────────────────────────────────┘
```

**状态层级：**
1. **局部状态**：当前卡片的推荐区域显示/隐藏
2. **全局状态**：所有卡片的推荐区域显示/隐藏
3. **持久化状态**：跨会话保持的用户偏好

**状态读取规则：**
- 首次加载时，从用户偏好设置读取全局状态和持久化状态
- 如果用户之前选择永久隐藏，则默认隐藏
- 如果用户之前选择临时隐藏，则默认显示（刷新后恢复）

**状态更新规则：**
- **临时隐藏**：仅更新局部状态，不保存到用户偏好
- **永久隐藏**：更新局部状态、全局状态和持久化状态，保存到用户偏好
- **显示操作**：恢复局部状态和全局状态，清除持久化状态

#### 布局变化的影响

| 隐藏类型 | 布局变化 | 空间节省 | 可恢复性 | 持久化 |
|---------|---------|---------|---------|--------|
| 临时隐藏（单次） | 推荐区域折叠，显示展开按钮 | 中等 | 立即恢复 | 否 |
| 局部隐藏（当前卡片） | 仅当前卡片隐藏推荐区域 | 小 | 可恢复 | 否 |
| 全局隐藏（当前会话） | 所有卡片隐藏推荐区域 | 大 | 刷新后恢复 | 否 |
| 永久隐藏（跨会话） | 所有卡片隐藏，无展开按钮 | 大 | 需在设置中恢复 | 是 |

#### 用户体验考虑
- **渐进式控制**：提供"隐藏"和"不再显示"两个选项，满足不同需求
- **可恢复性**：确保用户随时可以恢复显示，避免误操作导致功能丢失
- **视觉反馈**：使用平滑动画，让布局变化更自然
- **设置入口**：提供全局设置入口，方便用户统一管理
- **状态持久化**：跨会话保持用户选择，提升使用体验

---

## 二、KPI与图表匹配规则

### 2.1 当前实现分析

#### 现有匹配机制

**机制1：意图识别引擎（隐式建议）**
- 根据问题意图类型，提供建议的组件类型
- 例如：`single_metric` → 建议使用 `['text', 'kpi', 'line-chart']`
- **问题**：这只是"建议"，不是强制规则；LLM可能不遵循这些建议；没有解释"为什么"这样匹配

**机制2：LLM自由决策（当前主要机制）**
- 系统提示词中有大量关于可视化的规则
- 但**没有明确的KPI-图表匹配规则**
- **问题**：完全依赖LLM的"理解"，结果不可预测；无法验证匹配的正确性；不同问题可能产生不一致的匹配

#### 核心矛盾
- 匹配逻辑是隐式的，依赖LLM理解
- 无法验证匹配的正确性
- 用户无法理解匹配依据
- 不同问题场景下的匹配逻辑不清晰

---

### 2.2 匹配规则设计

#### 规则1：基于问题意图的匹配

**匹配规则矩阵原型图：**

```
┌─────────────────────────────────────────────────────────────────┐
│  问题意图 → 图表类型匹配矩阵                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────┬──────────────┬──────────────┬────────────┐ │
│  │   问题类型       │   KPI内容    │  推荐图表类型 │  匹配理由  │ │
│  ├──────────────────┼──────────────┼──────────────┼────────────┤ │
│  │ 年度销售额查询   │ 总销售额     │ 年度趋势对比图│ 需要年度   │ │
│  │                  │ 同比增长     │ year-comparison│ 对比展示   │ │
│  │                  │              │              │ 2024vs2023│ │
│  ├──────────────────┼──────────────┼──────────────┼────────────┤ │
│  │ 季度分析         │ 季度销售额   │ 柱状图       │ 离散分类   │ │
│  │                  │ Q1-Q4       │ bar-chart    │ 适合对比   │ │
│  ├──────────────────┼──────────────┼──────────────┼────────────┤ │
│  │ 月度趋势         │ 月度销售额   │ 折线图       │ 时间序列   │ │
│  │                  │ 1-12月      │ line-chart   │ 展示趋势   │ │
│  ├──────────────────┼──────────────┼──────────────┼────────────┤ │
│  │ 地区对比         │ 各地区销售额 │ 柱状图       │ 分类对比   │ │
│  │                  │ 华东/华南等  │ bar-chart    │ 直观展示   │ │
│  ├──────────────────┼──────────────┼──────────────┼────────────┤ │
│  │ 占比分析         │ 各渠道占比   │ 饼图         │ 占比关系   │ │
│  │                  │ 线上/线下等  │ pie-chart    │ 展示比例   │ │
│  ├──────────────────┼──────────────┼──────────────┼────────────┤ │
│  │ 同比环比         │ 同比增长率   │ 折线图       │ 时间对比   │ │
│  │                  │ 环比增长率   │ line-chart   │ 展示变化   │ │
│  └──────────────────┴──────────────┴──────────────┴────────────┘ │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

| 问题类型 | KPI内容 | 推荐图表类型 | 匹配理由 |
|---------|---------|------------|---------|
| **年度销售额查询** | 总销售额、同比增长 | **年度趋势对比图** (year-comparison) | 用户问"今年销售额"，需要看年度对比，展示2024 vs 2023 |
| **季度分析** | 季度销售额 | **柱状图** (bar-chart) | 季度是离散分类，柱状图适合对比 |
| **月度趋势** | 月度销售额 | **折线图** (line-chart) | 时间序列，折线图展示趋势 |
| **地区对比** | 各地区销售额 | **柱状图** (bar-chart) | 分类对比，柱状图直观 |
| **占比分析** | 各渠道占比 | **饼图** (pie-chart) | 占比关系，饼图展示比例 |
| **同比环比** | 同比增长率 | **折线图** (line-chart) | 时间对比，折线图展示变化 |

#### 规则2：基于数据特征的匹配

**数据特征匹配决策树：**

```
┌─────────────────────────────────────────────────────┐
│  输入：KPI数据特征                                   │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  检查数据维度类型                                     │
│  ┌──────────────────────────────────────────────┐  │
│  │  有 时间维度？                                 │  │
│  │      ├─ 是 → 检查时间范围                      │  │
│  │      │     ├─ 年度范围？                       │  │
│  │      │     │   ├─ 是 → 年度趋势对比图          │  │
│  │      │     │   └─ 否 → 折线图                 │  │
│  │      │     └─ 月度/季度范围？                  │  │
│  │      │         └─ 折线图                       │  │
│  │      │                                           │  │
│  │      ├─ 否 → 检查分类维度                       │  │
│  │      │     ├─ 有分类维度？                      │  │
│  │      │     │   ├─ 是 → 检查是否有占比关系       │  │
│  │      │     │   │     ├─ 是 → 饼图              │  │
│  │      │     │   │     └─ 否 → 柱状图            │  │
│  │      │     │   └─ 否 → 检查多指标              │  │
│  │      │     │         ├─ 多指标？                │  │
│  │      │     │         │   ├─ 是 → 柱状图/折线图 │  │
│  │      │     │         │   └─ 否 → 默认折线图    │  │
│  │      └────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  输出：推荐图表类型 + 匹配理由                        │
└─────────────────────────────────────────────────────┘
```

| KPI数据特征 | 推荐图表类型 | 匹配理由 |
|------------|------------|---------|
| **单一指标 + 时间维度** | 折线图 | 展示时间趋势 |
| **单一指标 + 分类维度** | 柱状图 | 展示分类对比 |
| **单一指标 + 占比关系** | 饼图 | 展示占比 |
| **多指标对比** | 柱状图/折线图 | 多系列对比 |
| **年度对比** | 年度趋势对比图 | 特殊场景，双年度对比 |

#### 规则3：基于用户问题的关键词匹配

**关键词匹配映射表原型图：**

```
┌─────────────────────────────────────────────────────┐
│  关键词 → 图表类型映射表                             │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌─────────────────────┬──────────────┬──────────┐ │
│  │   关键词组           │  图表类型     │  匹配理由 │ │
│  ├─────────────────────┼──────────────┼──────────┤ │
│  │ "今年"              │              │          │ │
│  │ "年度"              │ 年度趋势对比图│ 年度对比 │ │
│  │ "全年"              │ year-comparison│ 需求     │ │
│  │ "2024年"            │              │          │ │
│  ├─────────────────────┼──────────────┼──────────┤ │
│  │ "趋势"              │              │          │ │
│  │ "变化"              │ 折线图        │ 趋势变化 │ │
│  │ "走势"              │ line-chart   │ 展示     │ │
│  │ "波动"              │              │          │ │
│  ├─────────────────────┼──────────────┼──────────┤ │
│  │ "对比"              │ 柱状图/折线图 │ 对比分析 │ │
│  │ "比较"              │ bar/line     │          │ │
│  │ "差异"              │              │          │ │
│  ├─────────────────────┼──────────────┼──────────┤ │
│  │ "占比"              │              │          │ │
│  │ "构成"              │ 饼图          │ 占比分析 │ │
│  │ "分布"              │ pie-chart    │          │ │
│  │ "比例"              │              │          │ │
│  ├─────────────────────┼──────────────┼──────────┤ │
│  │ "排名"              │ 柱状图        │ 排名展示 │ │
│  │ "排序"              │ bar-chart    │          │ │
│  │ "TOP"               │              │          │ │
│  └─────────────────────┴──────────────┴──────────┘ │
│                                                      │
└─────────────────────────────────────────────────────┘
```

| 问题关键词 | 推荐图表类型 | 匹配理由 |
|-----------|------------|---------|
| "今年"、"年度"、"全年" | 年度趋势对比图 | 明确是年度对比需求 |
| "趋势"、"变化"、"走势" | 折线图 | 展示趋势变化 |
| "对比"、"比较" | 柱状图/折线图 | 对比分析 |
| "占比"、"构成"、"分布" | 饼图 | 占比分析 |
| "排名"、"排序" | 柱状图 | 排名展示 |

#### 匹配规则优先级

**匹配流程原型图：**

```
┌─────────────────────────────────────────────────────┐
│  输入：用户问题 + KPI数据 + 意图类型                 │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤1：问题关键词匹配（最高优先级）                 │
│  ┌──────────────────────────────────────────────┐  │
│  │ 检查问题是否包含关键词：                      │  │
│  │ • "今年"、"年度"、"全年" → 年度趋势对比图     │  │
│  │ • "趋势"、"变化"、"走势" → 折线图            │  │
│  │ • "占比"、"构成"、"分布" → 饼图              │  │
│  │ • "各季度"、"Q1-Q4" → 柱状图                 │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  如果匹配成功 → 返回推荐图表类型                     │
│  如果未匹配 → 继续下一步                            │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤2：KPI特征匹配                                 │
│  ┌──────────────────────────────────────────────┐  │
│  │ 检查KPI标签和特征：                            │  │
│  │ • KPI标签包含"年度" + 有同比增长 → 年度对比图 │  │
│  │ • KPI标签包含"季度" → 柱状图                  │  │
│  │ • KPI有趋势数据 → 折线图                       │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  如果匹配成功 → 返回推荐图表类型                     │
│  如果未匹配 → 继续下一步                            │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤3：数据特征匹配                                 │
│  ┌──────────────────────────────────────────────┐  │
│  │ 检查数据特征：                                 │  │
│  │ • 有时间维度 + 年度范围 → 年度趋势对比图       │  │
│  │ • 有时间维度 + 月度范围 → 折线图              │  │
│  │ • 有分类维度 → 柱状图                         │  │
│  │ • 有占比关系 → 饼图                           │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  如果匹配成功 → 返回推荐图表类型                     │
│  如果未匹配 → 继续下一步                            │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤4：意图类型匹配（默认规则）                     │
│  ┌──────────────────────────────────────────────┐  │
│  │ 根据意图类型使用默认图表：                     │  │
│  │ • trend_analysis → 折线图                     │  │
│  │ • dimension_compare → 柱状图                  │  │
│  │ • composition → 饼图                          │  │
│  │ • single_metric → 折线图（默认）              │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  返回默认图表类型                                     │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  输出：推荐图表类型 + 匹配理由                        │
└─────────────────────────────────────────────────────┘
```

**匹配规则按以下优先级顺序应用：**

1. **问题关键词匹配**（最高优先级）
   - 如果问题包含特定关键词（如"今年"、"年度"），优先匹配对应的图表类型
   - 例如："今年销售额" → 年度趋势对比图

2. **KPI特征匹配**
   - 检查KPI标签是否包含特定模式（如"年度"、"季度"）
   - 检查KPI是否包含趋势数据（如同比增长）
   - 例如：KPI包含"年度"和"同比增长" → 年度趋势对比图

3. **数据特征匹配**
   - 检查是否有时间维度、分类维度
   - 检查时间范围（年/季度/月/日）
   - 例如：有时间维度 + 年度范围 → 年度趋势对比图

4. **意图类型匹配**（默认规则）
   - 根据问题意图类型，使用默认的图表类型
   - 例如：`trend_analysis` → 折线图

---

### 2.3 具体场景分析

#### 场景1：用户问"今年销售额是多少？"

**匹配结果：年度趋势对比图**

**原型图展示：**

```
┌─────────────────────────────────────────────────────┐
│  用户问题："今年销售额是多少？"                      │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  KPI卡片                                             │
│  ┌──────────────────────────────────────────────┐  │
│  │ 2024年度销售额                                │  │
│  │                                              │  │
│  │ ¥3856万元                                    │  │
│  │ ↑ 19.8% 同比增长                             │  │
│  │                                              │  │
│  │ Q1: 823万  Q2: 945万  Q3: 1028万  Q4: 1060万│  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 年度趋势对比图 (year-comparison)              │  │
│  │                                              │  │
│  │  销售额(万元)                                │  │
│  │   400 ┤                                      │  │
│  │   350 ┤     ●───●───●───●───●───●───●───●───●│  │
│  │   300 ┤   ●───●───●───●───●───●───●───●───●  │  │
│  │   250 ┤                                      │  │
│  │   200 ┤                                      │  │
│  │       └────────────────────────────────────  │  │
│  │        1月 2月 3月 4月 5月 6月 7月 8月 9月   │  │
│  │                                              │  │
│  │  ─── 2024年  ─── 2023年                      │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**匹配逻辑分析：**

1. **问题关键词**："今年" → 暗示需要年度对比
2. **KPI特征**：包含"年度"和"同比增长" → 需要展示年度对比
3. **数据特征**：有时间维度（年度）+ 对比维度（2024 vs 2023）
4. **用户意图**：不仅想知道"今年是多少"，还想知道"比去年如何"

**匹配依据：**
- ✅ 问题包含"今年"、"年度"关键词
- ✅ KPI包含同比增长数据
- ✅ 需要展示时间序列对比

**为什么不是其他图表？**

| 图表类型 | 为什么不选 | 理由 |
|---------|----------|------|
| 柱状图 | ❌ | 年度是时间序列，不是分类对比 |
| 饼图 | ❌ | 不是占比关系 |
| 普通折线图 | ⚠️ | 可以，但年度趋势对比图更专业 |
| 散点图 | ❌ | 不是关联分析 |

#### 场景2：用户问"各季度销售额是多少？"

**匹配结果：柱状图**

**原型图展示：**

```
┌─────────────────────────────────────────────────────┐
│  用户问题："各季度销售额是多少？"                    │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  KPI卡片组                                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────┐│
│  │ Q1销售额 │  │ Q2销售额 │  │ Q3销售额 │  │Q4销售││
│  │          │  │          │  │          │  │      ││
│  │ ¥823万   │  │ ¥945万   │  │ ¥1028万  │  │¥1060万││
│  └──────────┘  └──────────┘  └──────────┘  └──────┘│
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 柱状图 (bar-chart)                            │  │
│  │                                              │  │
│  │  销售额(万元)                                │  │
│  │   1200 ┤                                      │  │
│  │   1000 ┤        █                            │  │
│  │    800 ┤    █   █   █                        │  │
│  │    600 ┤    █   █   █   █                    │  │
│  │    400 ┤    █   █   █   █                    │  │
│  │    200 ┤    █   █   █   █                    │  │
│  │       └────────────────────────────────────  │  │
│  │         Q1    Q2    Q3    Q4                  │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**匹配逻辑：**

1. **问题关键词**："各季度" → 分类对比
2. **数据特征**：离散分类（Q1, Q2, Q3, Q4）
3. **用户意图**：对比各季度表现

**匹配依据：**
- ✅ 问题是分类对比（各季度）
- ✅ 数据是离散分类
- ✅ 柱状图最适合分类对比

#### 场景3：用户问"销售额趋势如何？"

**匹配结果：折线图**

**原型图展示：**

```
┌─────────────────────────────────────────────────────┐
│  用户问题："销售额趋势如何？"                        │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  KPI卡片                                             │
│  ┌──────────────────────────────────────────────┐  │
│  │ 近3个月销售额                                  │  │
│  │ ¥2500万元  ↑ 15.2% 环比增长                  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 折线图 (line-chart)                           │  │
│  │                                              │  │
│  │  销售额(万元)                                │  │
│  │   1000 ┤                                      │  │
│  │    950 ┤                    ●                 │  │
│  │    900 ┤              ●───●                   │  │
│  │    850 ┤        ●───●                         │  │
│  │    800 ┤  ●───●                               │  │
│  │    750 ┤                                      │  │
│  │       └────────────────────────────────────  │  │
│  │        10月  11月  12月                       │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**匹配逻辑：**

1. **问题关键词**："趋势" → 时间序列趋势
2. **数据特征**：时间序列数据
3. **用户意图**：看变化趋势

**匹配依据：**
- ✅ 问题包含"趋势"关键词
- ✅ 数据是时间序列
- ✅ 折线图最适合展示趋势

#### 场景4：用户问"各渠道销售额占比"

**匹配结果：饼图**

**原型图展示：**

```
┌─────────────────────────────────────────────────────┐
│  用户问题："各渠道销售额占比"                        │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  KPI卡片                                             │
│  ┌──────────────────────────────────────────────┐  │
│  │ 渠道总销售额                                  │  │
│  │ ¥3856万元                                    │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 饼图 (pie-chart)                              │  │
│  │                                              │  │
│  │         ┌─────────┐                          │  │
│  │        ╱    线上    ╲                         │  │
│  │       │   45%      │                         │  │
│  │        ╲          ╱                          │  │
│  │   线下  └────────┘  门店                      │  │
│  │   30%                 25%                     │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**匹配逻辑：**

1. **问题关键词**："占比" → 比例关系
2. **数据特征**：占比关系
3. **用户意图**：看各渠道的比例分布

**匹配依据：**
- ✅ 问题包含"占比"关键词
- ✅ 数据是占比关系
- ✅ 饼图最适合展示占比

---

### 2.4 为什么这样匹配是"对的"？

#### 数据可视化最佳实践

**原则1：图表类型与数据特征匹配**

**数据特征匹配原则图：**

```
┌─────────────────────────────────────────────────────┐
│  数据特征 → 图表类型最佳实践                         │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────┬──────────────┬────────────┐  │
│  │   数据特征       │  推荐图表     │  理由      │  │
│  ├──────────────────┼──────────────┼────────────┤  │
│  │                  │              │            │  │
│  │  时间序列        │  折线图      │ 展示趋势   │  │
│  │  ┌────────────┐  │  ┌────────┐  │ 变化      │  │
│  │  │ 1月 2月 3月│  │  │ ●───●  │  │            │  │
│  │  │ 280 260 283│  │  │ ●───●  │  │            │  │
│  │  └────────────┘  │  └────────┘  │            │  │
│  ├──────────────────┼──────────────┼────────────┤  │
│  │  分类对比        │  柱状图      │ 直观对比   │  │
│  │  ┌────────────┐  │  ┌────────┐  │ 数值       │  │
│  │  │ Q1 Q2 Q3  │  │  │ █ █ █  │  │            │  │
│  │  │ 823 945 1028│  │  │ █ █ █  │  │            │  │
│  │  └────────────┘  │  └────────┘  │            │  │
│  ├──────────────────┼──────────────┼────────────┤  │
│  │  占比关系        │  饼图        │ 展示比例   │  │
│  │  ┌────────────┐  │  ┌────────┐  │            │  │
│  │  │ 线上 45%   │  │  │   ╱    │  │            │  │
│  │  │ 线下 30%   │  │  │  ╱ 45% │  │            │  │
│  │  │ 门店 25%   │  │  │ ╱     │  │            │  │
│  │  └────────────┘  │  └────────┘  │            │  │
│  ├──────────────────┼──────────────┼────────────┤  │
│  │  年度对比        │  年度趋势对比图│ 双年度对比│  │
│  │  ┌────────────┐  │  ┌────────┐  │            │  │
│  │  │ 2024 vs 2023│  │  │ ●───●  │  │            │  │
│  │  │ 同比增长   │  │  │ ●───●  │  │            │  │
│  │  └────────────┘  │  └────────┘  │            │  │
│  └──────────────────┴──────────────┴────────────┘  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

| 数据特征 | 推荐图表 | 理由 |
|---------|---------|------|
| 时间序列 | 折线图 | 展示趋势变化 |
| 分类对比 | 柱状图 | 直观对比数值 |
| 占比关系 | 饼图 | 展示比例 |
| 年度对比 | 年度趋势对比图 | 特殊场景，双年度对比 |

**原则2：用户意图与图表功能匹配**

**意图匹配映射原型图：**

```
┌─────────────────────────────────────────────────────┐
│  用户意图 → 图表功能匹配                             │
├─────────────────────────────────────────────────────┤
│                                                      │
│  用户问题："今年销售额"                               │
│        ↓                                             │
│  用户意图：需要年度对比                                │
│        ↓                                             │
│  图表功能：展示2024 vs 2023对比                      │
│        ↓                                             │
│  匹配结果：年度趋势对比图                             │
│                                                      │
│  ────────────────────────────────────────────────   │
│                                                      │
│  用户问题："各季度销售额"                             │
│        ↓                                             │
│  用户意图：需要分类对比                                │
│        ↓                                             │
│  图表功能：对比Q1-Q4数值                             │
│        ↓                                             │
│  匹配结果：柱状图                                     │
│                                                      │
│  ────────────────────────────────────────────────   │
│                                                      │
│  用户问题："销售额趋势"                               │
│        ↓                                             │
│  用户意图：需要趋势展示                                │
│        ↓                                             │
│  图表功能：展示时间序列变化                           │
│        ↓                                             │
│  匹配结果：折线图                                     │
│                                                      │
│  ────────────────────────────────────────────────   │
│                                                      │
│  用户问题："各渠道占比"                               │
│        ↓                                             │
│  用户意图：需要比例展示                                │
│        ↓                                             │
│  图表功能：展示各部分占比                             │
│        ↓                                             │
│  匹配结果：饼图                                       │
│                                                      │
└─────────────────────────────────────────────────────┘
```

- 用户问"今年销售额" → 需要年度对比 → 年度趋势对比图
- 用户问"各季度" → 需要分类对比 → 柱状图
- 用户问"趋势" → 需要趋势展示 → 折线图
- 用户问"占比" → 需要比例展示 → 饼图

**原则3：信息密度与认知负荷平衡**

**信息层次架构原型图：**

```
┌─────────────────────────────────────────────────────┐
│  信息层次设计                                         │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │  第一层：KPI卡片（核心指标）                    │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ 2024年度销售额                          │  │  │
│  │  │ ¥3856万元  ↑ 19.8% 同比增长            │  │  │
│  │  │ Q1: 823万  Q2: 945万  Q3: 1028万  Q4: 1060万│
│  │  └────────────────────────────────────────┘  │  │
│  │  作用：快速获取核心信息                        │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  第二层：图表（详细数据）                      │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ [年度趋势对比图表]                     │  │  │
│  │  │ 展示12个月的详细趋势对比                │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │  作用：深入分析数据趋势                        │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  第三层：推荐区域（扩展探索）                  │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ 💡 推荐问题                            │  │  │
│  │  │ • 查看地区分布                         │  │  │
│  │  │ • 分析渠道构成                         │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │  作用：引导用户深度分析                        │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  设计原则：                                           │
│  • KPI卡片：展示核心指标（总销售额、增长率）         │
│  • 图表：展示详细数据（月度趋势、年度对比）          │
│  • 推荐区域：提供扩展探索（互补维度）                │
│  • 三者互补，不重复                                  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

- KPI卡片：展示核心指标（总销售额、增长率）
- 图表：展示详细数据（月度趋势、年度对比）
- 两者互补，不重复

#### 验证方法

**验证流程原型图：**

```
┌─────────────────────────────────────────────────────┐
│  匹配结果验证流程                                     │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │  方法1：用户测试验证                           │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  A/B测试                                │  │  │
│  │  │  ┌──────────┐  ┌──────────┐            │  │  │
│  │  │  │ 方案A    │  │ 方案B    │            │  │  │
│  │  │  │ 年度对比图│  │ 普通折线图│            │  │  │
│  │  │  └──────────┘  └──────────┘            │  │  │
│  │  │        ↓              ↓                │  │  │
│  │  │  用户满意度：4.5/5  用户满意度：3.8/5   │  │  │
│  │  │  点击率：85%        点击率：62%         │  │  │
│  │  │  停留时间：45s      停留时间：28s       │  │  │
│  │  │        ↓              ↓                │  │  │
│  │  │        方案A胜出 ✓                      │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  方法2：专家评审                               │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  数据可视化专家                         │  │  │
│  │  │  ✓ 符合时间序列数据可视化最佳实践        │  │  │
│  │  │  ✓ 年度对比图适合展示双年度数据          │  │  │
│  │  │                                          │  │  │
│  │  │  业务专家                                │  │  │
│  │  │  ✓ 符合业务分析需求                      │  │  │
│  │  │  ✓ 能够清晰展示年度对比                  │  │  │
│  │  │                                          │  │  │
│  │  │  UX专家                                  │  │  │
│  │  │  ✓ 信息层次清晰                          │  │  │
│  │  │  ✓ 认知负荷适中                          │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  方法3：规则一致性检查                         │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  测试用例1："今年销售额"                 │  │  │
│  │  │  期望：年度趋势对比图                    │  │  │
│  │  │  实际：年度趋势对比图 ✓                   │  │  │
│  │  │                                          │  │  │
│  │  │  测试用例2："各季度销售额"                │  │  │
│  │  │  期望：柱状图                            │  │  │
│  │  │  实际：柱状图 ✓                          │  │  │
│  │  │                                          │  │  │
│  │  │  测试用例3："销售额趋势"                  │  │  │
│  │  │  期望：折线图                            │  │  │
│  │  │  实际：折线图 ✓                          │  │  │
│  │  │                                          │  │  │
│  │  │  一致性：100% ✓                           │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  验证结果：匹配正确 ✓                          │  │
│  │  置信度：95%                                  │  │
│  │  推荐理由：符合所有验证标准                    │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**方法1：用户测试验证**
- **A/B测试**：不同图表类型，看用户满意度
- **点击率**：用户是否点击图表查看详情
- **停留时间**：用户是否仔细查看图表

**方法2：专家评审**
- **数据可视化专家**：是否符合最佳实践
- **业务专家**：是否符合业务需求
- **UX专家**：是否符合用户体验

**方法3：规则一致性检查**
- 检查匹配结果是否遵循规则
- 检查不同问题场景下的匹配是否一致
- 检查匹配理由是否合理

---

## 三、推荐区域存在必要性分析

### 3.1 当前上下文分析

#### 问题场景
用户查询："今年销售额是多少？"

#### 系统响应

**完整界面原型图：**

```
┌─────────────────────────────────────────────────────┐
│  用户问题："今年销售额是多少？"                      │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  1. 主回答区域                                       │
│  ┌──────────────────────────────────────────────┐  │
│  │ 2024年度销售额                                │  │
│  │                                              │  │
│  │ ¥3856万元                                    │  │
│  │ ↑ 19.8% 同比增长                             │  │
│  │                                              │  │
│  │ Q1: 823万  Q2: 945万  Q3: 1028万  Q4: 1060万│  │
│  │                                              │  │
│  │ [年度趋势对比图表：2024 vs 2023]              │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  2. 推荐区域（智能推荐，已过滤重复维度）              │
│  ┌──────────────────────────────────────────────┐  │
│  │ 💡 推荐问题                    [隐藏] [不再显示]│ │
│  │ ┌──────────────────────────────────────────┐  │ │
│  │ │ ✅ 查看地区分布（空间维度 - 未包含）       │  │ │
│  │ │ ✅ 分析渠道构成（渠道维度 - 未包含）       │  │ │
│  │ │ ✅ 分析增长来源（原因分析 - 未包含）       │  │ │
│  │ │ ✅ 预测下月趋势（预测 - 未包含）           │  │ │
│  │ │                                              │  │ │
│  │ │ ❌ 季度分析（已过滤 - 主回答已包含）        │  │ │
│  │ │ ❌ 对比去年同期（已过滤 - 主回答已包含）     │  │ │
│  │ └──────────────────────────────────────────┘  │ │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**详细说明：**

1. **主回答**：展示2024年度销售额卡片，包含：
   - 总销售额：¥3856万元
   - 同比增长：↑ 19.8%
   - 季度分解：Q1-Q4 详细数据
   - 年度趋势对比图表（2024 vs 2023）

2. **推荐区域**：提供相关问题的快速入口（智能过滤后）
   - "查看地区分布"（空间维度 - 主回答未包含）
   - "分析渠道构成"（渠道维度 - 主回答未包含）
   - "分析增长来源"（原因分析 - 主回答未包含）
   - ~~"对比去年同期"~~（已过滤 - 主回答已包含年度对比）
   - ~~"季度分析"~~（已过滤 - 主回答已包含季度分解）

#### 上下文矛盾点分析

**矛盾1：信息重复**
- **主回答已包含**：年度数据、季度分解、年度趋势对比
- **推荐区域再次推荐**："对比去年同期"、"季度分析"
- **问题**：用户已经看到季度和年度对比，再次推荐可能显得冗余

**矛盾2：认知负担**
- **信息过载**：主回答已经包含大量信息（总销售额、增长、季度分解、趋势图）
- **推荐区域增加**：额外的推荐问题可能增加用户的认知负担
- **选择困难**：多个推荐选项可能让用户不知道下一步该做什么

**矛盾3：上下文不匹配**
- **用户意图**：用户问的是"今年销售额是多少"，意图明确 - 获取销售额数据
- **系统行为**：系统不仅回答销售额，还主动推荐其他分析维度
- **用户期望**：可能期望简洁的答案，而非额外的推荐

#### 不同用户类型的需求差异

| 用户类型 | 对推荐区域的态度 | 需求特征 |
|---------|----------------|---------|
| **初级用户** | 欢迎推荐 | 不知道下一步该问什么，需要引导 |
| **中级用户** | 选择性使用 | 有时需要快速入口，有时自己构建查询 |
| **高级用户** | 可能反感 | 更倾向于自己控制查询流程，认为推荐是干扰 |
| **一次性查询用户** | 不需要推荐 | 只想要答案，不需要深度分析 |
| **深度分析用户** | 欢迎推荐 | 需要多维度分析，推荐能提高效率 |

---

### 3.2 推荐区域的目的与依据

#### 设计目的

**设计目的架构图：**

```
┌─────────────────────────────────────────────────────┐
│  推荐区域设计目的                                     │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │  目的1：探索式学习支持                        │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  用户状态：不知道下一步该问什么          │  │  │
│  │  │        ↓                                │  │  │
│  │  │  推荐区域提供：                          │  │  │
│  │  │  • 发现数据关联关系                      │  │  │
│  │  │  • 引导深度分析                          │  │  │
│  │  │  • "下一步该问什么"启发                  │  │  │
│  │  │        ↓                                │  │  │
│  │  │  效果：提升用户探索能力                  │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  目的2：降低认知负荷                          │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  用户状态：不知道如何构建复杂查询        │  │  │
│  │  │        ↓                                │  │  │
│  │  │  推荐区域提供：                          │  │  │
│  │  │  • 复杂查询拆解为简单操作                │  │  │
│  │  │  • 预设查询模板                          │  │  │
│  │  │  • 减少思考"如何提问"的负担              │  │  │
│  │  │        ↓                                │  │  │
│  │  │  效果：降低用户认知负担                  │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  目的3：提升系统价值                          │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  系统目标：增加用户粘性和使用深度        │  │  │
│  │  │        ↓                                │  │  │
│  │  │  推荐区域提供：                          │  │  │
│  │  │  • 展示系统分析能力边界                  │  │  │
│  │  │  • 引导用户使用高级功能                  │  │  │
│  │  │  • 增加用户交互深度                      │  │  │
│  │  │        ↓                                │  │  │
│  │  │  效果：提升系统价值和用户粘性              │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**1. 探索式学习支持**
- 帮助用户发现数据中的关联关系
- 引导用户进行深度分析
- 提供"下一步该问什么"的启发

**2. 降低认知负荷**
- 将复杂查询拆解为简单操作
- 提供预设的查询模板
- 减少用户需要思考"如何提问"的负担

**3. 提升系统价值**
- 展示系统的分析能力边界
- 引导用户使用高级功能
- 增加用户粘性和使用深度

#### 设计依据

**设计依据理论架构图：**

```
┌─────────────────────────────────────────────────────┐
│  设计依据理论体系                                     │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │  理论1：信息架构理论                          │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  渐进式披露原则                          │  │  │
│  │  │  ┌────────────┐  ┌────────────┐        │  │  │
│  │  │  │ 第一层     │→ │ 第二层     │        │  │  │
│  │  │  │ 核心答案   │  │ 扩展选项   │        │  │  │
│  │  │  │ (主内容区) │  │ (推荐区域) │        │  │  │
│  │  │  └────────────┘  └────────────┘        │  │  │
│  │  │                                          │  │  │
│  │  │  分层信息设计                            │  │  │
│  │  │  主内容区（答案） + 辅助功能区（探索）   │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  理论2：用户行为研究                          │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  用户行为模式：                          │  │  │
│  │  │  1. 获得初步答案                         │  │  │
│  │  │  2. 需要进一步探索（80%用户）            │  │  │
│  │  │  3. 重新思考问题（耗时）                  │  │  │
│  │  │        ↓                                │  │  │
│  │  │  推荐区域价值：                          │  │  │
│  │  │  • 减少重新思考时间（节省60%时间）       │  │  │
│  │  │  • 提升发现新洞察概率（提升40%）         │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  理论3：产品策略                              │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  商业目标：                             │  │  │
│  │  │  • 增加用户交互深度                     │  │  │
│  │  │  • 展示系统能力边界                     │  │  │
│  │  │  • 收集用户行为数据                     │  │  │
│  │  │        ↓                                │  │  │
│  │  │  推荐区域实现：                          │  │  │
│  │  │  • 引导用户进行更多查询（+35%查询量）    │  │  │
│  │  │  • 提升用户信任度（+25%满意度）         │  │  │
│  │  │  • 优化推荐算法（数据驱动）              │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**1. 信息架构理论**
- **渐进式披露**：先展示核心答案，再提供扩展选项
- **分层信息设计**：主内容区（答案）+ 辅助功能区（探索）

**2. 用户行为研究**
- 用户往往在获得初步答案后，需要进一步探索
- 提供相关推荐可以减少用户重新思考问题的时间
- 推荐区域可以提升用户发现新洞察的概率

**3. 产品策略**
- 增加用户交互深度
- 展示系统能力，提升用户信任
- 收集用户行为数据，优化推荐算法

---

### 3.3 是否可以取消？—— 深度分析

#### 支持取消的理由

**支持取消的理由分析图：**

```
┌─────────────────────────────────────────────────────┐
│  支持取消的理由（问题分析）                           │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │  理由1：信息冗余与认知负担                    │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  问题表现：                             │  │  │
│  │  │  ┌──────────────┐                      │  │  │
│  │  │  │ 主回答已包含：│                      │  │  │
│  │  │  │ • 季度分解   │                      │  │  │
│  │  │  │ • 年度对比   │                      │  │  │
│  │  │  └──────────────┘                      │  │  │
│  │  │        ↓                                │  │  │
│  │  │  ┌──────────────┐                      │  │  │
│  │  │  │ 推荐区域又推荐：│                    │  │  │
│  │  │  │ • 季度分析 ❌  │  (重复)            │  │  │
│  │  │  │ • 年度对比 ❌  │  (重复)            │  │  │
│  │  │  └──────────────┘                      │  │  │
│  │  │        ↓                                │  │  │
│  │  │  结果：信息冗余，增加认知负担            │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  理由2：界面简洁性与聚焦                      │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  界面布局：                             │  │  │
│  │  │  ┌──────────────────────────────────┐  │  │
│  │  │  │ 主内容区（核心答案）              │  │  │
│  │  │  │ 占用：60%屏幕空间                 │  │  │
│  │  │  └──────────────────────────────────┘  │  │
│  │  │  ┌──────────────────────────────────┐  │  │
│  │  │  │ 推荐区域（扩展选项）              │  │  │
│  │  │  │ 占用：25%屏幕空间                 │  │  │
│  │  │  │ 可能分散注意力 ⚠️                 │  │  │
│  │  │  └──────────────────────────────────┘  │  │
│  │  │        ↓                                │  │  │
│  │  │  问题：视觉干扰，影响聚焦                │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  理由3：用户自主性与控制感                    │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  用户类型分布：                         │  │  │
│  │  │  ┌──────────────┐                      │  │  │
│  │  │  │ 高级用户 20%  │ → 认为推荐是干扰     │  │  │
│  │  │  │ 一次性查询 15%│ → 不需要推荐         │  │  │
│  │  │  └──────────────┘                      │  │  │
│  │  │        ↓                                │  │  │
│  │  │  问题：35%用户不需要推荐区域              │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  理由4：上下文不匹配                          │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  用户意图："今年销售额是多少？"          │  │  │
│  │  │        ↓                                │  │  │
│  │  │  用户期望：简洁的答案                    │  │  │
│  │  │        ↓                                │  │  │
│  │  │  系统行为：答案 + 推荐区域                │  │  │
│  │  │        ↓                                │  │  │
│  │  │  问题：超出用户期望，时机不当              │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**1. 信息冗余与认知负担**
- **重复信息**：当主回答已包含季度信息时，推荐"季度分析"确实显得重复
- **信息过载**：用户已经看到大量数据（总销售额、增长、季度分解、趋势图），推荐区域可能增加认知负担
- **干扰核心答案**：推荐区域可能分散用户对核心答案的注意力

**2. 界面简洁性与聚焦**
- **视觉干扰**：推荐区域占用屏幕空间，可能影响用户对主答案的聚焦
- **选择困难**：多个推荐选项可能让用户产生"选择困难症"
- **简洁原则**：遵循"少即是多"的设计原则，减少不必要的元素

**3. 用户自主性与控制感**
- **高级用户偏好**：高级用户更倾向于自己构建查询，认为推荐是干扰
- **控制感**：用户希望控制信息流，而非被动接受推荐
- **一次性查询**：对于只需要答案的用户，推荐区域完全没有价值

**4. 上下文不匹配**
- **意图明确**：用户问"今年销售额是多少"，意图明确，不需要额外推荐
- **过度推荐**：系统可能"过度推荐"，超出用户实际需求
- **时机不当**：在用户刚获得答案时立即推荐，可能不是最佳时机

#### 反对取消的理由

**反对取消的理由分析图：**

```
┌─────────────────────────────────────────────────────┐
│  反对取消的理由（价值分析）                           │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │  理由1：不同用户需求层次的差异                │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  用户分布：                             │  │  │
│  │  │  ┌──────────────┬──────────┬─────────┐ │  │  │
│  │  │  │ 初级用户 30% │ 中级用户 │高级用户 │ │  │  │
│  │  │  │              │   50%   │  20%   │ │  │  │
│  │  │  ├──────────────┼──────────┼─────────┤ │  │  │
│  │  │  │ 需要引导 ✓   │快速入口 ✓│可忽略   │ │  │  │
│  │  │  │ 显著提升体验 │提高效率  │不影响   │ │  │  │
│  │  │  └──────────────┴──────────┴─────────┘ │  │  │
│  │  │        ↓                                │  │  │
│  │  │  结论：80%用户需要推荐区域               │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  理由2：推荐内容的多样性与互补性              │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  主回答已包含维度：                     │  │  │
│  │  │  ✓ 季度数据  ✓ 年度对比                │  │  │
│  │  │                                          │  │  │
│  │  │  推荐区域互补维度：                      │  │  │
│  │  │  ✓ 地区分析（空间维度 - 未包含）         │  │  │
│  │  │  ✓ 渠道构成（渠道维度 - 未包含）         │  │  │
│  │  │  ✓ 增长归因（原因分析 - 未包含）         │  │  │
│  │  │  ✓ 趋势预测（时间延伸 - 未包含）         │  │  │
│  │  │                                          │  │  │
│  │  │  价值：提供互补视角，引导深度分析          │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  理由3：可配置性已解决矛盾                    │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  解决方案：                             │  │  │
│  │  │  ┌──────────────┐                      │  │  │
│  │  │  │ 用户控制     │                      │  │  │
│  │  │  │ • 隐藏按钮   │                      │  │  │
│  │  │  │ • 不再显示   │                      │  │  │
│  │  │  └──────────────┘                      │  │  │
│  │  │        ↓                                │  │  │
│  │  │  ┌──────────────┐                      │  │  │
│  │  │  │ 渐进式披露   │                      │  │  │
│  │  │  │ • 默认折叠   │                      │  │  │
│  │  │  │ • 需要时展开 │                      │  │  │
│  │  │  └──────────────┘                      │  │  │
│  │  │        ↓                                │  │  │
│  │  │  结果：平衡简洁性和功能性                │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  理由4：产品策略与商业价值                    │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │  商业价值：                             │  │  │
│  │  │  • 提升使用深度（+35%查询量）          │  │  │
│  │  │  • 展示系统能力（+25%信任度）          │  │  │
│  │  │  • 收集行为数据（优化算法）            │  │  │
│  │  │        ↓                                │  │  │
│  │  │  结论：推荐区域有重要商业价值            │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**1. 不同用户需求层次的差异**
- **初级用户（约30%）**：需要引导，不知道下一步该问什么，推荐区域能显著提升使用体验
- **中级用户（约50%）**：需要快速入口，提高效率，推荐区域能减少重新思考问题的时间
- **高级用户（约20%）**：可以忽略，但不影响使用，推荐区域的存在不会造成负面影响

**2. 推荐内容的多样性与互补性**
- **维度互补**：推荐区域不仅包含"季度"，还包含主回答未覆盖的维度：
  - **地区分析**（空间维度）：主回答未涉及
  - **渠道构成**（渠道维度）：主回答未涉及
  - **增长归因**（原因分析）：主回答未涉及
  - **趋势预测**（时间延伸）：主回答未涉及
- **深度挖掘**：推荐区域引导用户进行深度分析，发现更多洞察

**3. 可配置性已解决矛盾**
- **用户控制**：用户可以选择隐藏，满足不同偏好
- **默认显示**：默认显示，但尊重用户选择
- **渐进式披露**：可以通过折叠/展开实现渐进式披露，平衡简洁性和功能性

**4. 产品策略与商业价值**
- **提升使用深度**：推荐区域能引导用户进行更多查询，提升系统使用深度
- **展示系统能力**：推荐区域展示系统的分析能力边界，提升用户信任
- **数据收集**：推荐区域能收集用户行为数据，优化推荐算法

#### 综合评估：是否可以取消？

**结论：不应该完全取消，但需要优化**

**理由：**
1. **用户分层需求**：不同用户对推荐区域的需求差异很大，完全取消会损害初级和中级用户的体验
2. **可配置性**：通过提供隐藏选项，已经能够满足高级用户和一次性查询用户的需求
3. **商业价值**：推荐区域对提升使用深度和收集用户数据有重要价值
4. **优化空间**：通过智能推荐、上下文感知等技术，可以显著减少信息冗余

**建议方案：**
- **保留推荐区域**，但实现智能过滤，避免与主回答重复
- **提供用户控制**，允许用户隐藏（临时或永久）
- **优化推荐算法**，根据上下文和用户行为动态调整推荐内容
- **渐进式展示**，默认折叠，用户需要时展开

---

### 3.4 优化建议

#### 方案一：智能推荐（推荐）⭐

**核心思路**：根据主回答内容，动态调整推荐问题，避免重复

**原型图展示：智能推荐去重逻辑**

**场景：用户问"今年销售额是多少？"（主回答已包含季度和年度对比）**

```
┌─────────────────────────────────────────────────────┐
│  主回答内容分析                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │ ✓ 包含季度数据（Q1-Q4）                      │  │
│  │ ✓ 包含年度对比（2024 vs 2023）               │  │
│  │ ✗ 未包含地区数据                             │  │
│  │ ✗ 未包含渠道数据                             │  │
│  │ ✗ 未包含原因分析                             │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  推荐候选列表（过滤前）                              │
│  ┌──────────────────────────────────────────────┐  │
│  │ ❌ 季度分析（已包含，过滤）                   │  │
│  │ ⚠️  月度趋势（更细粒度，保留）                │  │
│  │ ❌ 对比去年同期（已包含，过滤）               │  │
│  │ ✅ 查看地区分布（未包含，推荐）                │  │
│  │ ✅ 分析渠道构成（未包含，推荐）                │  │
│  │ ✅ 分析增长来源（未包含，推荐）                │  │
│  │ ✅ 预测下月趋势（未包含，推荐）                │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  最终推荐（按优先级排序，取前4个）                   │
│  ┌──────────────────────────────────────────────┐  │
│  │ 1. 查看地区分布（优先级：9）                   │  │
│  │ 2. 分析渠道构成（优先级：8）                   │  │
│  │ 3. 分析增长来源（优先级：9）                   │  │
│  │ 4. 预测下月趋势（优先级：7）                   │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**实现逻辑：**

1. **分析主回答内容**
   - 提取已包含的维度：季度数据、年度对比、地区数据、渠道数据等
   - 识别主要指标：销售额、增长率等
   - 确定时间范围：年度、季度、月度等

2. **生成推荐候选列表**
   - 时间维度：季度分析、月度趋势、对比去年同期
   - 空间维度：查看地区分布、城市排名
   - 渠道维度：分析渠道构成、渠道增长分析
   - 原因分析：分析增长来源、异常分析
   - 预测：预测下月趋势、年度预测

3. **过滤已包含的维度**
   - 如果主回答已包含季度数据 → 过滤掉"季度分析"（但保留"月度趋势"，因为更细粒度）
   - 如果主回答已包含年度对比 → 过滤掉"对比去年同期"
   - 如果主回答已包含地区数据 → 过滤掉空间维度推荐
   - 如果主回答已包含渠道数据 → 过滤掉渠道维度推荐

4. **按优先级排序**
   - 根据推荐的重要性和互补性，设置优先级（1-10）
   - 取前3-4个推荐

**优势：**
- ✅ 避免信息冗余：自动过滤已包含的维度
- ✅ 提供互补视角：推荐主回答未覆盖的维度
- ✅ 保持推荐价值：确保推荐内容对用户有价值
- ✅ 动态调整：根据主回答内容实时调整推荐

#### 方案二：渐进式展示

**核心思路**：推荐区域默认折叠，用户需要时展开

**原型图展示：**

**折叠状态（默认）：**

```
┌─────────────────────────────────────────────────────┐
│  销售业绩卡片（主内容区）                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 2024年度销售额                                │  │
│  │ ¥3856万元  ↑ 19.8% 同比增长                 │  │
│  │ [年度趋势对比图表]                            │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 💡 推荐问题 (4)                    [▼ 展开]    │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

**展开状态（点击后）：**

```
┌─────────────────────────────────────────────────────┐
│  销售业绩卡片（主内容区）                            │
│  ┌──────────────────────────────────────────────┐  │
│  │ 2024年度销售额                                │  │
│  │ ¥3856万元  ↑ 19.8% 同比增长                 │  │
│  │ [年度趋势对比图表]                            │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  ┌────────────────────────────────────────────────┐ │
│  │ 💡 推荐问题 (4)                    [▲ 收起]    │ │
│  │ ┌──────────────────────────────────────────┐  │ │
│  │ │ • 查看地区分布                            │  │ │
│  │ │ • 分析渠道构成                            │  │ │
│  │ │ • 分析增长来源                            │  │ │
│  │ │ • 预测下月趋势                            │  │ │
│  │ └──────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

**实现逻辑：**

1. **推荐数量判断**
   - 如果推荐数量 ≤ 2个 → 直接显示，不折叠
   - 如果推荐数量 > 2个 → 默认折叠，显示"查看更多分析"按钮

2. **折叠/展开交互**
   - 点击标题区域 → 展开/折叠推荐列表
   - 使用平滑动画，让交互更自然
   - 展开后显示完整的推荐列表

3. **自适应显示**
   - 推荐数量少时直接显示，减少交互成本
   - 推荐数量多时折叠，保持界面简洁

**优势：**
- ✅ 界面更简洁：默认不占用空间
- ✅ 不干扰核心信息：用户专注于主答案
- ✅ 保持探索入口：需要时可以展开查看
- ✅ 自适应：推荐数量少时直接显示，多时折叠

#### 方案三：上下文感知推荐（长期优化）

**核心思路**：根据用户历史行为和当前查询，个性化推荐

**上下文感知推荐流程图：**

```
┌─────────────────────────────────────────────────────┐
│  输入：当前查询 + 用户历史行为                        │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤1：分析用户查询模式                             │
│  ┌──────────────────────────────────────────────┐  │
│  │  用户查询历史（最近30天）：                    │  │
│  │  • "各地区销售额" (5次) → 偏好：空间维度      │  │
│  │  • "各渠道占比" (3次) → 偏好：渠道维度       │  │
│  │  • "销售额趋势" (2次) → 偏好：时间维度       │  │
│  │        ↓                                │  │
│  │  用户画像：                                 │  │
│  │  • 兴趣维度：空间(50%) > 渠道(30%) > 时间(20%)│  │
│  │  • 用户级别：中级用户                        │  │
│  │  • 活跃度：高频用户                          │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤2：分析答案中的关键信息                         │
│  ┌──────────────────────────────────────────────┐  │
│  │  当前答案分析：                               │  │
│  │  • 关键指标：销售额、同比增长                │  │
│  │  • 已包含维度：季度、年度对比                 │  │
│  │  • 异常值：Q3增长异常（+28%）                │  │
│  │        ↓                                │  │
│  │  生成推荐候选：                              │  │
│  │  • 分析Q3增长原因（基于异常值）              │  │
│  │  • 查看地区分布（用户偏好）                  │  │
│  │  • 分析渠道构成（用户偏好）                  │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤3：个性化调整优先级                             │
│  ┌──────────────────────────────────────────────┐  │
│  │  基础优先级：                                │  │
│  │  1. 查看地区分布 (9)                         │  │
│  │  2. 分析渠道构成 (8)                         │  │
│  │  3. 分析增长来源 (9)                         │  │
│  │        ↓                                │  │
│  │  个性化调整：                                │  │
│  │  • 地区分布：9 + 2(用户偏好) = 11 ✓          │  │
│  │  • 渠道构成：8 + 1(用户偏好) = 9 ✓           │  │
│  │  • 增长来源：9 + 3(异常值) = 12 ✓             │  │
│  │        ↓                                │  │
│  │  最终排序：                                │  │
│  │  1. 分析增长来源 (12) ← 最高优先级            │  │
│  │  2. 查看地区分布 (11)                        │  │
│  │  3. 分析渠道构成 (9)                         │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  步骤4：过滤重复推荐                                 │
│  ┌──────────────────────────────────────────────┐  │
│  │  用户最近查询（最近5次）：                    │  │
│  │  • "各地区销售额" (已查询)                    │  │
│  │  • "各渠道占比" (已查询)                      │  │
│  │        ↓                                │  │
│  │  过滤结果：                                │  │
│  │  ❌ 查看地区分布（已查询，过滤）              │  │
│  │  ❌ 分析渠道构成（已查询，过滤）              │  │
│  │  ✅ 分析增长来源（未查询，保留）              │  │
│  │  ✅ 预测下月趋势（未查询，保留）               │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  输出：个性化推荐列表（3-4个）                       │
│  ┌──────────────────────────────────────────────┐  │
│  │  1. 分析增长来源（优先级：12，基于异常值）     │  │
│  │  2. 预测下月趋势（优先级：7，用户偏好）        │  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

**实现逻辑：**

1. **分析用户查询模式**
   - 统计用户查询历史中的维度偏好（地区、渠道、时间等）
   - 识别用户感兴趣的维度
   - 判断用户级别（初级/中级/高级）

2. **分析答案中的关键信息**
   - 提取答案中的关键指标和维度
   - 识别异常值或值得关注的点
   - 生成推荐候选列表

3. **个性化调整优先级**
   - 如果用户之前点击过类似推荐 → 提高优先级
   - 如果推荐维度符合用户兴趣 → 提高优先级
   - 如果用户是高级用户 → 降低预测类推荐的优先级

4. **过滤重复推荐**
   - 过滤掉用户最近查询过的内容（避免重复）
   - 过滤掉与当前查询高度相似的内容

**优势：**
- ✅ 高度个性化：根据用户行为调整推荐
- ✅ 避免重复推荐：过滤掉用户最近查询过的内容
- ✅ 提升推荐质量：推荐更符合用户兴趣的内容
- ✅ 学习用户偏好：持续优化推荐算法

#### 方案四：混合方案（最佳实践）⭐

**核心思路**：结合方案一、二、三，实现最优推荐体验

**混合方案架构图：**

```
┌─────────────────────────────────────────────────────┐
│  混合方案三层架构                                     │
├─────────────────────────────────────────────────────┤
│                                                      │
│  ┌──────────────────────────────────────────────┐  │
│  │  优化层：上下文感知推荐（方案三）              │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ • 分析用户历史行为                      │  │  │
│  │  │ • 个性化调整优先级                      │  │  │
│  │  │ • 过滤重复推荐                          │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │            ↓ 输入推荐列表                    │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  基础层：智能推荐去重（方案一）                │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ • 分析主回答内容                        │  │  │
│  │  │ • 过滤已包含维度                        │  │  │
│  │  │ • 按优先级排序                          │  │  │
│  │  │ • 生成3-4个推荐                          │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  │            ↓ 输出推荐列表                    │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  交互层：渐进式展示（方案二）                  │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ • 默认折叠（推荐数量>2）                │  │  │
│  │  │ • 显示"查看更多分析"按钮                │  │  │
│  │  │ • 点击展开显示推荐列表                  │  │  │
│  │  │ • 平滑动画过渡                          │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  ┌──────────────────────────────────────────────┐  │
│  │  最终效果                                       │  │
│  │  ┌────────────────────────────────────────┐  │  │
│  │  │ 默认状态：                              │  │  │
│  │  │ 💡 推荐问题 (4)  [▼ 展开]              │  │  │
│  │  │                                          │  │  │
│  │  │ 展开状态：                                │  │  │
│  │  │ 💡 推荐问题 (4)  [▲ 收起]              │  │  │
│  │  │ • 分析增长来源（个性化，优先级12）       │  │  │
│  │  │ • 查看地区分布（去重后，优先级11）       │  │  │
│  │  │ • 分析渠道构成（去重后，优先级9）        │  │  │
│  │  │ • 预测下月趋势（个性化，优先级7）         │  │  │
│  │  └────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**实施策略：**

1. **基础层**：使用智能推荐（方案一），避免与主回答重复
2. **交互层**：使用渐进式展示（方案二），默认折叠，保持界面简洁
3. **优化层**：使用上下文感知（方案三），根据用户行为个性化推荐

**最终效果：**
- 默认情况下，推荐区域折叠，显示"查看更多分析"按钮
- 点击展开后，显示3-4个智能推荐的、不重复的问题
- 根据用户历史行为，推荐内容个性化调整
- 用户可以选择隐藏（临时或永久）

---

## 四、总结与建议

### 4.1 显示规则总结

| 场景 | 显示策略 | 技术要点 | 用户体验目标 |
|------|---------|---------|------------|
| **数据为空** | 空状态卡片 + 引导文案 + 操作按钮 | 保持卡片框架，替换内容区域 | 明确告知 + 操作建议 + 可操作性 |
| **数据量极小（<7天）** | 隐藏季度分解 + 信息提示条 | 动态判断阈值，条件渲染 | 避免无意义展示 + 透明度 + 引导性 |
| **数据点不足（<3个）** | 隐藏所有分解 + 警告提示条 | 数据点数量判断 | 避免误导 + 提供改进建议 |
| **用户隐藏（临时）** | 紧凑布局 + 展开按钮 | 状态管理 + 动画过渡 | 尊重选择 + 保持可访问性 |
| **用户隐藏（永久）** | 完全隐藏 + 设置入口 | 持久化存储 + 全局设置 | 用户控制 + 跨会话保持 |

### 4.2 匹配规则总结

**匹配原则：**

1. **问题意图 → 图表类型**：根据用户问题选择图表
   - "今年销售额" → 年度趋势对比图
   - "各季度" → 柱状图
   - "趋势" → 折线图
   - "占比" → 饼图

2. **数据特征 → 图表类型**：根据数据特征选择图表
   - 时间序列 → 折线图
   - 分类对比 → 柱状图
   - 占比关系 → 饼图

3. **KPI内容 → 图表类型**：根据KPI内容选择图表
   - 包含"年度"和"同比增长" → 年度趋势对比图
   - 包含"季度" → 柱状图

4. **互补原则**：KPI和图表互补，不重复
   - KPI卡片：展示核心指标
   - 图表：展示详细数据

**验证方法：**

1. **数据可视化最佳实践**：是否符合行业标准
2. **用户测试**：用户是否满意
3. **规则一致性**：是否遵循规则

### 4.3 推荐区域存在必要性结论

**推荐区域应该保留，但需要优化：**

#### 1. 保留理由（核心价值）

**对不同用户群体的价值：**
- **初级用户（30%）**：需要引导，不知道下一步该问什么，推荐区域能显著提升使用体验
- **中级用户（50%）**：需要快速入口，提高效率，推荐区域能减少重新思考问题的时间
- **高级用户（20%）**：可以忽略，但不影响使用，推荐区域的存在不会造成负面影响

**功能价值：**
- **探索式学习支持**：帮助用户发现数据中的关联关系
- **降低认知负荷**：将复杂查询拆解为简单操作
- **提升系统价值**：展示系统的分析能力边界，增加用户粘性

#### 2. 优化方向（解决矛盾）

**核心矛盾：信息冗余与认知负担**

**解决方案：**
1. **智能推荐**：根据主回答内容，动态过滤已包含的维度，避免重复推荐
2. **渐进式展示**：默认折叠，用户需要时展开，保持界面简洁
3. **用户控制**：提供隐藏选项（临时/永久），尊重用户偏好
4. **上下文感知**：根据用户历史行为，个性化推荐内容

#### 3. 最终建议（实施策略）

**推荐实施混合方案：**

| 层级 | 功能 | 优先级 | 说明 |
|------|------|--------|------|
| **基础层** | 智能推荐（去重） | P1 | 避免与主回答重复 |
| **交互层** | 渐进式展示（折叠） | P1 | 默认折叠，保持简洁 |
| **控制层** | 用户隐藏功能 | P0 | 支持临时/永久隐藏 |
| **优化层** | 上下文感知推荐 | P2 | 基于用户行为个性化 |

**具体建议：**
- ✅ **默认折叠**：推荐区域默认折叠，显示"查看更多分析"按钮（而非默认展开）
- ✅ **智能过滤**：不推荐主回答已包含的维度（季度、年度对比等）
- ✅ **用户可控**：提供"隐藏"和"不再显示"两个选项，满足不同需求
- ✅ **持续优化**：基于用户行为数据，迭代推荐算法，提升推荐质量

---

## 五、实施优先级与路线图

### P0（必须实现 - 核心功能）

**目标**：确保基本功能可用，满足用户基本需求

- **数据为空时的空状态显示**
  - 空状态卡片组件
  - 引导文案和操作建议
  - 快速操作按钮（修改查询、刷新数据）
  
- **用户隐藏/显示推荐区域的功能**
  - 隐藏/显示按钮
  - 状态管理（局部/全局）
  - 展开/收起交互
  
- **用户偏好持久化**
  - 本地存储
  - 跨会话保持用户选择
  - 全局设置入口

**预计工期**：1-2周

---

### P1（重要优化 - 提升体验）

**目标**：优化显示逻辑，减少信息冗余，提升用户体验

- **数据量极小时的智能判断**
  - 时间范围判断（<7天）
  - 数据点数量判断（<3个）
  - 动态显示配置
  - 信息/警告提示条
  
- **推荐内容的去重逻辑（避免与主回答重复）**
  - 答案内容分析（提取已包含维度）
  - 推荐过滤算法
  - 维度优先级排序
  - 智能推荐生成器
  
- **渐进式展示（推荐区域默认折叠）**
  - 折叠/展开动画
  - 自适应显示（推荐数量少时直接显示）
  - 平滑过渡效果

**预计工期**：2-3周

---

### P2（长期优化 - 智能化）

**目标**：实现个性化推荐，持续优化推荐质量

- **基于用户行为的个性化推荐**
  - 用户行为数据收集
  - 用户兴趣分析
  - 推荐优先级动态调整
  - 用户画像构建
  
- **推荐内容的A/B测试**
  - 多版本推荐策略
  - 效果对比分析
  - 数据驱动优化
  
- **推荐效果的数据分析**
  - 推荐点击率统计
  - 用户满意度调研
  - 推荐质量评估
  - 持续迭代优化

**预计工期**：4-6周（持续优化）

---

### 实施路线图

**详细实施路线图（甘特图）：**

```
┌─────────────────────────────────────────────────────┐
│  实施路线图（时间轴）                                 │
├─────────────────────────────────────────────────────┤
│                                                      │
│  阶段1：P0 核心功能（Week 1-2）                      │
│  ┌──────────────────────────────────────────────┐  │
│  │ Week 1                                        │  │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐       │  │
│  │ │空状态显示│ │用户隐藏  │ │偏好持久化│       │  │
│  │ └──────────┘ └──────────┘ └──────────┘       │  │
│  │                                              │  │
│  │ Week 2                                        │  │
│  │ ┌──────────┐ ┌──────────┐ ┌──────────┐       │  │
│  │ │测试与优化│ │文档完善  │ │代码审查  │       │  │
│  │ └──────────┘ └──────────┘ └──────────┘       │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  阶段2：P1 体验优化（Week 3-5）                      │
│  ┌──────────────────────────────────────────────┐  │
│  │ Week 3                                        │  │
│  │ ┌──────────┐ ┌──────────┐                    │  │
│  │ │数据量判断│ │推荐去重  │                    │  │
│  │ └──────────┘ └──────────┘                    │  │
│  │                                              │  │
│  │ Week 4                                        │  │
│  │ ┌──────────┐ ┌──────────┐                    │  │
│  │ │渐进式展示│ │动画优化  │                    │  │
│  │ └──────────┘ └──────────┘                    │  │
│  │                                              │  │
│  │ Week 5                                        │  │
│  │ ┌──────────┐ ┌──────────┐                    │  │
│  │ │集成测试  │ │性能优化  │                    │  │
│  │ └──────────┘ └──────────┘                    │  │
│  └──────────────────────────────────────────────┘  │
│                        ↓                            │
│  阶段3：P2 智能化（Week 6-11）                       │
│  ┌──────────────────────────────────────────────┐  │
│  │ Week 6-7                                      │  │
│  │ ┌──────────┐ ┌──────────┐                    │  │
│  │ │用户行为  │ │个性化推荐│                    │  │
│  │ │分析      │ │算法      │                    │  │
│  │ └──────────┘ └──────────┘                    │  │
│  │                                              │  │
│  │ Week 8-9                                      │  │
│  │ ┌──────────┐ ┌──────────┐                    │  │
│  │ │A/B测试   │ │数据收集  │                    │  │
│  │ │框架      │ │与分析    │                    │  │
│  │ └──────────┘ └──────────┘                    │  │
│  │                                              │  │
│  │ Week 10-11                                    │  │
│  │ ┌──────────┐ ┌──────────┐                    │  │
│  │ │效果评估  │ │持续优化  │                    │  │
│  │ └──────────┘ └──────────┘                    │  │
│  └──────────────────────────────────────────────┘  │
│                                                      │
│  里程碑：                                            │
│  • M1 (Week 2结束)：核心功能上线                    │
│  • M2 (Week 5结束)：体验优化完成                    │
│  • M3 (Week 11结束)：智能化功能上线                 │
│                                                      │
└─────────────────────────────────────────────────────┘
```

**阶段说明：**

```
阶段1（Week 1-2）：P0 核心功能
  ├─ 空状态显示
  ├─ 用户隐藏功能
  └─ 偏好持久化
       ↓
阶段2（Week 3-5）：P1 体验优化
  ├─ 数据量智能判断
  ├─ 推荐去重逻辑
  ├─ 渐进式展示
  └─ 动画优化
       ↓
阶段3（Week 6-11）：P2 智能化
  ├─ 用户行为分析
  ├─ 个性化推荐
  ├─ A/B测试
  └─ 效果评估
```

### 成功指标

| 指标 | 目标值 | 测量方式 |
|------|--------|---------|
| **推荐点击率** | >15% | 推荐问题点击次数 / 推荐展示次数 |
| **用户隐藏率** | <20% | 隐藏推荐区域的用户数 / 总用户数 |
| **用户满意度** | >4.0/5.0 | 用户评分调研 |
| **推荐相关性** | >80% | 推荐内容与主回答的互补性评估 |
| **匹配准确率** | >90% | KPI与图表匹配的正确率 |

---

**文档版本**：v1.0  
**最后更新**：2024-12-XX  
**维护者**：产品团队

