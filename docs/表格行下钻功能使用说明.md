# 表格行下钻功能使用说明

## 功能概述

表格行下钻功能允许用户在表格中点击特定行，查看更详细的数据或执行下钻分析。支持三种下钻按钮样式：

1. **带指示器的按钮** - 显示 `[🔍 下钻分析 3]`，带数量徽章
2. **悬浮按钮** - 鼠标悬停时显示 `[⬇]` 圆形按钮
3. **文字按钮** - 显示 `查看详情 →` 文字链接

## 🎯 如何触发显示

### 方式一：直接提问（推荐）

在聊天界面输入以下任意一个问题，即可看到带下钻功能的表格：

- **`表格下钻示例`**
- **`显示表格下钻`**
- **`表格行下钻`**
- **`各地区销售额对比表格`**

### 方式二：使用场景ID

直接输入场景ID：**`table-drilldown-example`**

### 方式三：在代码中使用

如果需要在代码中创建带下钻的表格，参考下面的数据格式说明。

## 数据格式

### 基础表格格式（无下钻）

```typescript
{
  headers: ['地区', '销售额', '增长率'],
  rows: [
    ['华东地区', '¥1,350万', '+25.3%'],
    ['华南地区', '¥980万', '+18.5%'],
    ['华北地区', '¥720万', '+15.2%'],
  ]
}
```

### 带下钻的表格格式

#### 1. 带指示器的按钮样式

```typescript
{
  headers: ['地区', '销售额', '增长率', '操作'],
  rows: [
    {
      cells: ['华东地区', '¥1,350万', '+25.3%'],
      drillDown: {
        type: 'button',        // 按钮样式
        count: 3               // 显示数量（可选）
      }
    }
  ]
}
```

**效果**：在最后一列显示蓝色按钮 `[🔍 下钻分析 3]`

#### 2. 悬浮按钮样式

```typescript
{
  headers: ['地区', '销售额', '增长率'],
  rows: [
    {
      cells: ['华东地区', '¥1,350万', '+25.3%'],
      drillDown: {
        type: 'hover'          // 悬浮按钮样式
      }
    }
  ]
}
```

**效果**：鼠标悬停时在行右侧显示圆形按钮 `[⬇]`

#### 3. 文字按钮样式

```typescript
{
  headers: ['地区', '销售额', '增长率', '操作'],
  rows: [
    {
      cells: ['华东地区', '¥1,350万', '+25.3%'],
      drillDown: {
        type: 'text',          // 文字按钮样式
        label: '查看详情'      // 自定义文字（可选，默认"查看详情"）
      }
    }
  ]
}
```

**效果**：在最后一列显示蓝色文字链接 `查看详情 →`

### 带子行的下钻（展开/收起）

```typescript
{
  headers: ['地区', '销售额', '增长率'],
  rows: [
    {
      cells: ['华东地区', '¥1,350万', '+25.3%'],
      children: [              // 子行数据
        { cells: ['上海市', '¥450万', '+28.5%'] },
        { cells: ['江苏省', '¥520万', '+24.2%'] },
        { cells: ['浙江省', '¥380万', '+23.1%'] },
      ],
      drillDown: {
        type: 'button',
        count: 3               // 子行数量
      }
    }
  ]
}
```

**效果**：
- 点击按钮或行首箭头可展开/收起子行
- 子行以缩进方式显示在父行下方
- 有平滑的展开/收起动画

## 完整示例

### 示例 1：混合使用三种按钮样式

```typescript
const tableData = {
  headers: ['地区', '销售额', '增长率', '操作'],
  rows: [
    // 带指示器的按钮
    {
      cells: ['华东地区', '¥1,350万', '+25.3%'],
      drillDown: {
        type: 'button',
        count: 3
      }
    },
    // 悬浮按钮
    {
      cells: ['华南地区', '¥980万', '+18.5%'],
      drillDown: {
        type: 'hover'
      }
    },
    // 文字按钮
    {
      cells: ['华北地区', '¥720万', '+15.2%'],
      drillDown: {
        type: 'text',
        label: '查看详情'
      }
    },
    // 普通行（无下钻）
    ['西南地区', '¥650万', '+12.8%'],
  ]
};

// 在 ContentBlock 中使用
const tableBlock: ContentBlock = {
  id: 'table_1',
  type: 'table',
  data: tableData
};
```

### 示例 2：带子行的下钻

```typescript
const tableData = {
  headers: ['地区', '销售额', '增长率'],
  rows: [
    {
      cells: ['华东地区', '¥1,350万', '+25.3%'],
      children: [
        { cells: ['上海市', '¥450万', '+28.5%'] },
        { cells: ['江苏省', '¥520万', '+24.2%'] },
        { cells: ['浙江省', '¥380万', '+23.1%'] },
      ],
      drillDown: {
        type: 'button',
        count: 3
      }
    },
    {
      cells: ['华南地区', '¥980万', '+18.5%'],
      children: [
        { cells: ['广东省', '¥580万', '+20.1%'] },
        { cells: ['广西省', '¥400万', '+16.5%'] },
      ],
      drillDown: {
        type: 'text',
        label: '查看详情'
      }
    }
  ]
};
```

## 在测试用例中使用

如果需要在 `testCaseData.ts` 中使用，可以添加 table 构建器：

```typescript
// 在 B 对象中添加
table: (data: any): ContentBlock => ({ 
  id: generateId(), 
  type: 'table', 
  data 
}),

// 使用示例
B.table({
  headers: ['地区', '销售额', '增长率'],
  rows: [
    {
      cells: ['华东地区', '¥1,350万', '+25.3%'],
      drillDown: {
        type: 'button',
        count: 3
      }
    }
  ]
})
```

## 下钻操作处理

点击下钻按钮时，会触发 `onDrillDown` 回调：

```typescript
onDrillDown={(rowData) => {
  if (rowData.children && rowData.children.length > 0) {
    // 如果有子数据，可以在这里处理展开逻辑
    console.log('下钻数据:', rowData);
  } else {
    // 否则发送查询进行分析
    const drillQuery = `详细分析${JSON.stringify(rowData.cells || rowData)}的数据`;
    onActionSelect?.(drillQuery);
  }
}}
```

## 注意事项

1. **按钮位置**：
   - `button` 和 `text` 类型：显示在最后一列
   - `hover` 类型：显示在行右侧（独立列）

2. **子行展开**：
   - 如果行有 `children` 属性，点击行首箭头或下钻按钮都可以展开
   - 子行会以缩进方式显示，带有平滑动画

3. **兼容性**：
   - 支持旧格式 `string[][]`（普通表格行）
   - 支持新格式带 `drillDown` 配置的对象

4. **样式说明**：
   - 带下钻的行会有悬停效果（背景色变化）
   - 按钮和文字都有过渡动画
   - 悬浮按钮只在鼠标悬停时显示

