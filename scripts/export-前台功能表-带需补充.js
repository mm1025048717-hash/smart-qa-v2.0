import XLSX from 'xlsx';
import path from 'path';
import { fileURLToPath } from 'url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));

const headers = ['功能名称', '类型', '功能描述', '优先级', '状态', '负责人', '计划版本', '发布版本', '所属模块', '需补充'];

// 完整数据：按用户提供的表整理，已去重（删除重复的「查看仪表盘列表」及末尾空表头行），并标注需补充
const rows = [
  // ========== 智能问答 ==========
  ['智能问答', '模块', '前台交互-智能问答', '', '', '', '', '', '前台交互', '模块标题'],
  ['新建会话', '操作', '点击"+"号开启新对话', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['切换会话', '操作', '在左侧列表点击切换不同历史会话', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['删除会话', '操作', '删除不需要的历史记录', 'P2', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['切换空间', '操作', '切换不同的工作空间(Workspace)', 'P2', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['文本提问', '操作', '输入自然语言问题', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['语音输入', '操作', '点击麦克风进行语音转文字输入', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['附件上传', '操作', '上传Excel/CSV/PDF作为临时分析素材', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['切换Agent', '操作', '在输入框上方选择不同的数字员工(如CFO/销售)', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['中断生成', '操作', '点击停止按钮中断输出', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['重新生成', '操作', '对当前回答不满意点击Retry', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['查看数据表格', '视图', '以Grid形式展示结构化数据结果', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['下载数据', '操作', '将表格数据下载为Excel/CSV', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['查看Echarts图表', '视图', '自动生成的柱状/折线/饼图', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['切换图表类型', '操作', '手动切换图表样式', 'P2', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['查看推理过程', '视图', '展示DeepSeek/LLM的思考链(Chain of Thought)', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['查看SQL代码', '视图', 'Debug模式下查看生成的SQL语句', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['复制SQL', '操作', '一键复制SQL代码', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  ['点赞/点踩', '操作', '收集RLHF反馈数据', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', ''],
  // ========== AI员工市场 ==========
  ['AI员工市场', '模块', '前台交互-AI员工市场', '', '', '', '', '', '前台交互', '模块标题'],
  ['按角色筛选', '操作', '筛选财务/销售/供应链等角色', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', 'AI员工市场', ''],
  ['激活员工', '操作', 'Toggle开关：将该员工加入聊天列表', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', 'AI员工市场', ''],
  ['停用员工', '操作', 'Toggle开关：移除员工', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', 'AI员工市场', ''],
  ['查看员工详情', '操作', '点击卡片查看详细能力介绍', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', 'AI员工市场', ''],
  // ========== 数据看板（已去重：仅保留一条「查看仪表盘列表」） ==========
  ['数据看板', '模块', '前台交互-数据看板', '', '', '', '', '', '前台交互', '模块标题'],
  ['查看仪表盘列表', '视图', '查看所有已创建的仪表板列表，包括名称、发布状态、创建者、修改人、修改时间等', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', '（原表重复项已去重）'],
  ['搜索仪表板', '操作', '根据关键词在仪表板列表中进行搜索', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['筛选仪表板', '操作', '根据状态、类型等条件筛选仪表板列表', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['新建仪表板', '操作', '弹出创建仪表板对话框，创建并配置新仪表板', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['填写看板名称', '操作', '在创建对话框中输入仪表板名称，必填项', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['填写简称', '操作', '在创建对话框中输入仪表板简称，可选项', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['添加标签', '操作', '在创建/编辑对话框中为仪表板添加分类标签', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['确认创建看板', '操作', '提交仪表板信息，完成创建', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['取消创建', '操作', '关闭创建对话框，放弃本次创建', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['选择仪表板', '操作', '通过复选框选择一个或多个仪表板，为批量操作做准备', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['预览/查看仪表板', '视图', '点击查看图标，预览或查看仪表板详细内容（含预置固化报表及自定义仪表盘）', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['编辑仪表板名称/标签', '操作', '修改仪表板的名称、简称、标签等属性', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['收藏仪表板', '操作', '将仪表板标记为收藏，方便快速访问', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['更多仪表板操作', '操作', '通过三点菜单提供删除、分享等操作', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['删除仪表盘', '操作', '从仪表盘列表中删除不需要的仪表盘', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['管理发布状态', '操作', '查看并设置仪表板的发布状态（如未发布）', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['控制仪表板显示', '操作', '通过「仪表板示」等复选框控制列表显示模式或选项', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['筛选仪表盘（全局）', '操作', '对仪表盘进行全局时间、机构或标签等条件筛选', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['返回目录', '操作', '从仪表盘详情返回仪表盘列表或目录', 'P2', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['仪表盘阅读模式', '视图', '切换到只读模式，方便查看仪表盘', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['仪表盘编排模式', '操作', '切换到编辑模式，对仪表盘布局和组件进行编排', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['筛选 - 统计周期', '操作', '根据统计周期（如 2024.01~2025.10）筛选仪表盘数据', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['筛选 - 分析维度', '操作', '根据分析维度（如全部地区）筛选仪表盘数据', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['执行查询', '操作', '应用筛选条件并刷新仪表盘数据', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['保存看板', '操作', '保存当前仪表盘的配置和数据视图', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['下载仪表盘', '操作', '下载当前仪表盘的数据或报告', 'P2', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['分享仪表盘', '操作', '分享当前仪表盘给其他用户或生成分享链接', 'P2', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['全屏显示', '视图', '将仪表盘切换到全屏显示模式', 'P2', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['看板配置', '操作', '配置仪表盘的各项设置，如权限、数据源等', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['智能问答（看板内）', '交互', '通过自然语言与 AI 助手进行问答，获取数据洞察', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['AI 助手 - 看板编辑', '交互', 'AI 提供基于自然语言理解的看板编辑辅助', 'P1', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  ['AI 助手 - 答案评分', '操作', '用户对 AI 助手的回答进行满意度评分', 'P2', '开发中', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', ''],
  // ========== 系统搭建 - 数据源管理 ==========
  ['数据源管理', '模块', '系统搭建-数据源管理', '', '', '', '', '', '系统搭建', '模块标题'],
  ['新建连接', '操作', '填写DB品牌、Host、Port、User等连接信息', 'P0', '已上线', 'User', '2.0-Alpha', '2.0-Alpha', '数据源管理', '需补充：描述可完善为「新建数据源连接，填写DB类型、Host、Port、用户名等」'],
  ['配置SSH隧道', '操作', '开启SSH Tunnel并填写Jump Server信息', 'P2', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '数据源管理', ''],
  ['测试连接', '操作', '验证数据库连通性', 'P0', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '数据源管理', ''],
  ['同步元数据', '操作', 'Sync Metadata：获取最新表结构', 'P0', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '数据源管理', ''],
  ['编辑连接', '操作', '修改连接信息', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '数据源管理', ''],
  ['删除连接', '操作', '删除数据源（需校验是否有依赖）', 'P2', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '数据源管理', ''],
  // ========== 业务建模 ==========
  ['业务建模', '模块', '系统搭建-业务建模', '', '', '', '', '', '系统搭建', '模块标题'],
  ['学习Schema', '操作', '从数据源表中导入并自动分析Schema', 'P0', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '业务建模', ''],
  ['编辑基本信息', '操作', '修改Schema名称、描述、实体/事件类型', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '业务建模', ''],
  ['刷新字段', '操作', '重新读取表结构字段', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '业务建模', ''],
  ['编辑属性/字段', '操作', '设置字段语义类型(货币/时间)及同义词', 'P0', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '业务建模', ''],
  ['配置动态SQL', '操作', '开启/关闭动态SQL生成模式', 'P2', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '业务建模', ''],
  ['配置层级结构', '操作', '定义维度层级(如 省>市>区)', 'P2', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '业务建模', ''],
  // ========== ER关系图 ==========
  ['ER关系图', '模块', '系统搭建-ER关系图', '', '', '', '', '', '系统搭建', '模块标题'],
  ['查看关系图', '视图', '可视化展示模型关联', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', 'ER关系图', ''],
  ['新建连线', '操作', '拖拽实体建立Join关系', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', 'ER关系图', ''],
  ['编辑关系', '操作', '设置Join Type (Left/Inner)及关联键', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', 'ER关系图', ''],
  // ========== 指标配置 ==========
  ['指标配置', '模块', '系统搭建-指标配置', '', '', '', '', '', '系统搭建', '模块标题'],
  ['新建复合指标', '操作', '基于已有指标进行加减乘除定义', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '指标配置', ''],
  ['新建原子指标', '操作', '使用SQL/Javascript定义基础指标', 'P0', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '指标配置', ''],
  ['测试指标', '操作', '输入参数验证指标计算结果', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '指标配置', ''],
  // ========== 知识库配置 ==========
  ['知识库配置', '模块', '系统搭建-知识库配置', '', '', '', '', '', '系统搭建', '模块标题'],
  ['新建术语', '操作', '填写关键词、同义词、定义', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '知识库配置', '需补充：描述可完善为「新建业务术语，填写关键词、同义词、定义等」'],
  ['编辑术语', '操作', '修改定义逻辑', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '知识库配置', ''],
  ['新建全局同义词', '操作', '添加数据库标准词与同义词映射', 'P1', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '知识库配置', ''],
  ['调整问答优先级', '操作', '拖拽调整不同知识源的召回权重', 'P2', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '知识库配置', ''],
  // ========== 指令中心 ==========
  ['指令中心', '模块', '系统搭建-指令中心', '', '', '', '', '', '系统搭建', '模块标题'],
  ['新建指令', '操作', '定义Trigger和Action', 'P1', '开发中', 'Dev', '2.0-Alpha', '2.0-Alpha', '指令中心', '需补充：待实现后补充详细描述与验收标准'],
  // ========== AI员工管理 - 员工配置 ==========
  ['员工配置', '模块', 'AI员工管理-员工配置', '', '', '', '', '', 'AI员工管理', '模块标题'],
  ['上传头像', '操作', '自定义员工头像', 'P2', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '员工配置', ''],
  ['切换模型', '操作', '选择底层LLM (如DeepSeek/GPT-4)', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '员工配置', ''],
  ['编辑System Prompt', '操作', '核心人设与指令定义', 'P0', '已上线', 'PM', '2.0-Alpha', '2.0-Alpha', '员工配置', ''],
  ['绑定技能', '操作', '勾选该员工可用的工具(Tools)', 'P1', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '员工配置', ''],
  ['配置数据范围', '操作', '勾选该员工可访问的Schema/表', 'P0', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '员工配置', ''],
  // ========== 运维与监控 - 审计日志 ==========
  ['审计日志', '模块', '运维与监控-审计日志', '', '', '', '', '', '运维与监控', '模块标题'],
  ['查看会话列表', '视图', '查看所有用户的历史会话', 'P1', '已上线', 'Ops', '2.0-Alpha', '2.0-Alpha', '审计日志', ''],
  ['筛选记录', '操作', '按时间/用户/状态筛选', 'P1', '已上线', 'Ops', '2.0-Alpha', '2.0-Alpha', '审计日志', ''],
  ['查看消息详情', '操作', '查看具体的Prompt和Response', 'P1', '已上线', 'Ops', '2.0-Alpha', '2.0-Alpha', '审计日志', ''],
  // ========== 测试与核验 ==========
  ['测试与核验', '模块', '运维与监控-测试与核验', '', '', '', '', '', '运维与监控', '模块标题'],
  ['新建测试用例', '操作', '输入问题、预期SQL、预期结果', 'P1', '已上线', 'QA', '2.0-Alpha', '2.0-Alpha', '测试与核验', '需补充：描述可完善为「新建单条测试用例，填写问题、预期SQL、预期结果等」'],
  ['批量导入用例', '操作', '上传Excel批量导入', 'P1', '已上线', 'QA', '2.0-Alpha', '2.0-Alpha', '测试与核验', ''],
  ['执行回归测试', '操作', '一键运行测试计划', 'P0', '已上线', 'QA', '2.0-Alpha', '2.0-Alpha', '测试与核验', ''],
  ['查看测试报告', '视图', '查看通过率及Bad Case', 'P0', '已上线', 'QA', '2.0-Alpha', '2.0-Alpha', '测试与核验', ''],
  ['运行SQL测试', '操作', '在SQL编辑器中执行查询', 'P2', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '测试与核验', ''],
  ['格式化SQL', '操作', '美化SQL代码', 'P2', '已上线', 'Dev', '2.0-Alpha', '2.0-Alpha', '测试与核验', ''],
  // ========== 全局设置 ==========
  ['全局设置', '模块', '运维与监控-全局设置', '', '', '', '', '', '运维与监控', '模块标题'],
  ['发布公告', '操作', '全员可见的系统通知', 'P2', '已上线', 'Ops', '2.0-Alpha', '2.0-Alpha', '全局设置', ''],
  ['导入配置包', '操作', '迁移环境时导入配置', 'P2', '已上线', 'Ops', '2.0-Alpha', '2.0-Alpha', '全局设置', ''],
  ['导出配置包', '操作', '备份当前系统配置', 'P2', '已上线', 'Ops', '2.0-Alpha', '2.0-Alpha', '全局设置', ''],
  // ========== 建议补充功能（供产品确认） ==========
  ['[建议补充] 会话重命名', '操作', '对历史会话进行重命名便于识别', 'P2', '待确认', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', '建议补充'],
  ['[建议补充] 导出会话', '操作', '将会话记录导出为文件', 'P2', '待确认', 'PM', '2.0-Alpha', '2.0-Alpha', '智能问答', '建议补充'],
  ['[建议补充] 批量操作仪表板', '操作', '批量删除/发布/移动仪表板', 'P2', '待确认', 'PM', '2.0-Alpha', '2.0-Alpha', '数据看板', '建议补充'],
];

const data = [headers, ...rows];
const ws = XLSX.utils.aoa_to_sheet(data);

ws['!cols'] = [
  { wch: 24 },
  { wch: 8 },
  { wch: 52 },
  { wch: 8 },
  { wch: 10 },
  { wch: 8 },
  { wch: 12 },
  { wch: 12 },
  { wch: 14 },
  { wch: 48 },
];

const wb = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb, ws, '功能表');

const outPath = path.join(__dirname, '..', '前台功能表-带需补充.xlsx');
XLSX.writeFile(wb, outPath);

console.log('已导出: ' + outPath);
