# 🎤 语音功能使用指南

## 问题：语音按钮无法点击

### 原因
语音按钮只有在**语音服务已启动**且**WebSocket 连接成功**后才能点击。

## ✅ 解决步骤

### 步骤 1: 启动语音服务

**方法 A: 一键启动（推荐）**
```bash
一键启动语音服务.bat
```

**方法 B: 手动启动**
```bash
cd voice-backend
启动服务.bat
```

### 步骤 2: 等待服务启动

看到以下信息表示启动成功：
```
WebSocket server ready on ws://localhost:8765
```

### 步骤 3: 刷新浏览器

- 按 `F5` 或 `Ctrl+R` 刷新页面
- 这是**必须的**，否则前端无法连接到新启动的服务

### 步骤 4: 使用语音功能

1. **点击语音按钮**（输入框左侧的麦克风图标）
2. **允许麦克风权限**（浏览器会弹出权限请求）
3. **开始说话**
4. **AI 会自动识别并回复**

## 🔍 检查连接状态

在语音输入区域，有一个**连接状态指示器**（小圆点）：
- 🟢 **绿色**：已连接，可以正常使用
- ⚪ **灰色**：未连接，按钮无法点击

## ⚠️ 常见问题

### Q: 按钮仍然是灰色的？

**检查清单**：
1. ✅ 语音服务是否已启动？（运行 `诊断语音服务.bat`）
2. ✅ 是否已刷新浏览器页面？
3. ✅ 浏览器控制台是否有错误？
4. ✅ 端口 8765 是否被占用？

### Q: 点击按钮后没有反应？

可能是麦克风权限问题：
1. 检查浏览器地址栏左侧的权限图标
2. 点击权限图标，允许麦克风访问
3. 如果被拒绝，需要在浏览器设置中重新授权

### Q: 服务启动失败？

**检查**：
1. Python 是否已安装（运行 `python --version`）
2. 依赖是否已安装（运行 `voice-backend\install.bat`）
3. `.env` 文件是否配置正确

## 🛠️ 诊断工具

- **诊断脚本**：`诊断语音服务.bat` - 检查所有配置
- **一键启动**：`一键启动语音服务.bat` - 自动启动服务
- **查看配置**：`voice-backend\查看配置.bat` - 查看 API Key 配置

## 💡 提示

1. **服务需要一直运行**：不要关闭启动服务的命令行窗口
2. **首次使用**：需要下载模型，可能需要 20 秒左右
3. **浏览器权限**：确保已允许麦克风权限
4. **HTTPS 要求**：某些浏览器在 HTTPS 下才允许麦克风访问

## 📞 需要帮助？

如果按照以上步骤操作后仍然无法使用，请：
1. 运行 `诊断语音服务.bat` 查看详细诊断信息
2. 检查浏览器控制台的错误信息
3. 查看相关文档：
   - [语音按钮无法点击-解决方案.md](./语音按钮无法点击-解决方案.md)
   - [WebSocket连接问题-快速修复.md](./WebSocket连接问题-快速修复.md)
   - [README_VOICE.md](./README_VOICE.md) - 完整集成指南

